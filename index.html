<!DOCTYPE html><html><head><title>Noble City</title><style>html,body{background-color:#111;width:100%;height:100%;margin:0;padding:0;overflow:hidden;display:flex;justify-content:center;align-items:center;}canvas{display:block;image-rendering:pixelated;object-fit:contain;box-shadow:0 0 30px #000}</style></head><body><canvas id="game"></canvas><script>(()=>{var J=class{x=0;y=0;sm=1;get w(){return Math.floor(this.dom.width/this.sm)}set w(t){this.dom.width=t}get h(){return Math.floor(this.dom.height/this.sm)}set h(t){this.dom.height=t}set s(t){this.sx=t,this.sy=t}sx=1;sy=1;scale(t){this.dom.width*=t,this.dom.height*=t,this._ctx=this.dom.getContext("2d"),this._ctx.imageSmoothingEnabled=!1,this._ctx.scale(t,t),this.sm*=t}full(){document.body.requestFullscreen()}def={bz:1};cursor="default";tolisten=[];render(t={},...r){let e=this._eng;r.length||(r=[t],t={});for(let n of r){this._ctx.save();let i={};if(Object.assign(i,this.def,t,n),(i.click||i.hover||i.press)&&i.p!=null&&this.tolisten.push(i),i.f&&i.f in e.audios){e.audios[i.f].active=!0,e.audios[i.f].volume=i.a??1;continue}let a=i.f!=null&&!(i.f in e.imgs),s=i.b!=null&&!(i.b in e.imgs),o=i.crop!=null&&i.crop.length==4,p=i.crop!=null&&i.crop.length>=8;if(a&&(this._ctx.fillStyle=i.f),s&&(this._ctx.strokeStyle=i.b),this._ctx.lineCap=i.be=="arc"?"round":i.be=="sqr"?"square":"butt",this._ctx.lineJoin=i.bj=="arc"?"round":i.bj=="sqr"?"bevel":"miter",this._ctx.lineWidth=i.bz??1,i.a==0){this._ctx.restore();continue}this._ctx.globalAlpha=i.a??1,i.c=i.c??1;let[m,u]=[Math.pow(this.sx,i.c),Math.pow(this.sy,i.c)];i.sx=(i.sx??i.s??1)*m,i.sy=(i.sy??i.s??1)*u;let[c,y]=i.r?[Math.sin(i.r),Math.cos(i.r)]:[0,1],[v,F]=[this.w/2*i.c*Math.pow(this.sx,i.c-1)+this.x*(1-i.c-m)+(i.x??0)*m,this.h/2*i.c*Math.pow(this.sy,i.c-1)+this.y*(1-i.c-u)+(i.y??0)*u],mt=this.rect(i);if(this._ctx.transform(i.sx*y,i.sx*c,-i.sy*c,i.sy*y,v,F),i.m&&i.m.length==6?this._ctx.transform.apply(this._ctx,i.m):i.m&&e.error_add(new Error(`Invalid transform [${i.m.toString()}]`)),this._ctx.translate(mt[0][0]/i.sx,mt[0][1]/i.sy),i.f&&!a){let d=i.crop&&o?[i.crop[2],i.crop[3]]:i.crop&&p?[i.crop[4]*(i.crop[6]+1),i.crop[5]*(i.crop[7]+1)]:[this._eng.imgs[i.f].width,this._eng.imgs[i.f].height];if(d=[Math.abs(d[0]*i.sx*y),Math.abs(d[1]*i.sy*y)],this.w+d[0]<v||this.h+d[1]<F||v+d[0]<0||F+d[1]<0){this._ctx.restore();continue}}if(i.f!=null&&i.f in e.imgs){if(i.crop&&o)this._ctx.drawImage(e.imgs[i.f],i.crop[0],i.crop[1],i.crop[2],i.crop[3],0,0,i.crop[2],i.crop[3]);else if(i.crop&&p){let d=i.crop[2]*(i.crop[6]%1||1),M=i.crop[4]*(i.crop[6]%1||1),g=i.crop[3]*(i.crop[7]%1||1),W=i.crop[5]*(i.crop[6]%1||1),S=Math.ceil(i.crop[6]),ct=Math.ceil(i.crop[7]);for(let j=0;j<=S;j++)for(let P=0;P<=ct;P++)this._ctx.drawImage(e.imgs[i.f],(i.crop[0]+i.crop[2]-d)*(j==0?0:j==S?1:.5)+(i.crop[8]??0),(i.crop[1]+i.crop[3]-g)*(P==0?0:P==ct?1:.5)+(i.crop[9]??0),d,g,M*j,W*P,d,g)}else this._ctx.drawImage(e.imgs[i.f],0,0);i.p=i.p??mt}if(i.p){let d=0,M=0;this._ctx.beginPath();for(let g of i.p)g.length==2&&!d?this._ctx.moveTo(g[0],g[1]):g.length==2&&M==1?(this._ctx.lineTo(i.p[d-2][0]+g[0],i.p[d-2][1]),this._ctx.lineTo(i.p[d-2][0]+g[0],i.p[d-2][1]+g[1]),this._ctx.lineTo(i.p[d-2][0],i.p[d-2][1]+g[1])):g.length==2?this._ctx.lineTo(g[0],g[1]):g.length==0&&d>0&&i.p[d-1].length==2&&d+1!=i.p.length&&i.p[d+1].length==2?M=1:g.length==0&&d+1==i.p.length&&this._ctx.closePath(),d++;s&&this._ctx.stroke(),a&&(i.bz??1)&&this._ctx.fill()}if(i.t){let d=i.tz??20,[M,g]=[0,0],[W,S]=[!1,!1];this._ctx.font=`${d}px ${i.tf&&i.tf in e.fonts?e.fonts[i.tf]:i.tf??"Arial"}`,(W=[0,.5,1].includes(i.ox))&&(this._ctx.textAlign=i.ox==0?"start":i.ox==1?"end":"center"),(S=[0,.5,1].includes(i.oy))&&(this._ctx.textBaseline=i.oy==0?"top":i.oy==1?"bottom":"middle"),W||(M=-this._ctx.measureText(i.t).width*i.ox),S||(g=-d*i.oy),s&&(i.bz??1)&&this._ctx.strokeText(i.t,M,g),a||(this._ctx.fillStyle="#000"),(!a&&!s||a)&&this._ctx.fillText(i.t,M,g)}this._ctx.restore()}}play(t,r=1,e=0){if(t in this._eng.audios){let n=new Audio;return n.src=this._eng.base+t,n.volume=r,n.currentTime=e,n.addEventListener("ended",()=>n=null),n.play(),!0}return!1}clear(){this._ctx.clearRect(0,0,this.w,this.h)}fit=!1;fitfull(){let{width:t,height:r}=(this.dom.parentElement||this.dom).getBoundingClientRect(),e=this.w/this.h;t/r>e?(this.dom.style.width="auto",this.dom.style.height="100%"):(this.dom.style.width="100%",this.dom.style.height="auto")}tile(t){let r=t.sx!=null?t.sx:t.s!=null?t.s:this.def.sx!=null?this.def.sx:this.def.s!=null?this.def.s:1,e=t.sy!=null?t.sy:t.s!=null?t.s:this.def.sy!=null?this.def.sy:this.def.s!=null?this.def.s:1,n=this.dom.getBoundingClientRect(),i=n.width/this.w,a=n.height/this.h,s=this.w/innerWidth;if(!t.f||!(t.f in this._eng.imgs))t.f!=null&&(this.dom.style.background=t.f);else{if(!this._tile_pic.includes(t.f)){let o=document.createElement("link");o.setAttribute("rel","preload"),o.setAttribute("href",`${this._eng.base}${t.f}`),o.setAttribute("as","image"),document.body.appendChild(o)}this.dom.style.backgroundImage=`url(${this._eng.base}${t.f})`,this.dom.style.backgroundPosition=`calc(50% + ${((t.x||0)-this.x)*this.sx*i}px) calc(50% + ${((t.y||0)-this.y)*this.sy*a}px)`,this.dom.style.backgroundSize=`${this._eng.imgs[t.f].width*this.sx*r/s}px ${this._eng.imgs[t.f].height*this.sy*e/s}px`}}_tile_pic=[];rect(t){let r=t.f!=null&&!(t.f in this._eng.imgs),e=t.crop!=null&&t.crop.length==4,n=t.crop!=null&&t.crop.length>=8;t.ox=t.ox??(!t.o||!t.o.includes("w")&&!t.o.includes("e")?.5:t.o&&t.o.includes("e")?1:0),t.oy=t.oy??(!t.o||!t.o.includes("n")&&!t.o.includes("s")?.5:t.o&&t.o.includes("s")?1:0);let i=t.crop&&e?[t.crop[2],t.crop[3]]:t.crop&&n?[t.crop[4]*(t.crop[6]+1)-(t.crop[8]??0),t.crop[5]*(t.crop[7]+1)-(t.crop[9]??0)]:t.f&&!r?[this._eng.imgs[t.f].width,this._eng.imgs[t.f].height]:[0,0];return[[i[0]*-(t.ox??.5)*(t.sx??t.s??1),i[1]*-(t.oy??.5)*(t.sy??t.s??1)],[],[i[0]*(t.sx??t.s??1),i[1]*(t.sy??t.s??1)],[]]}dom;scene=null;_ctx;_eng;constructor(t="",r,e=640,n=360){this.dom=typeof t!="string"?t:t.length&&document.querySelector(t)?document.querySelector(t):document.createElement("canvas"),this.dom.style.aspectRatio=`${e} / ${n}`,this.w=e,this.h=n,this._ctx=this.dom.getContext("2d"),this._ctx.imageSmoothingEnabled=!1,this._eng=r,r.cameras.push(this),r.inp.bind(this)}},pt=class{x=0;_x=0;_gx=0;get dx(){return this.x-this._x}set dx(t){this._x=this.x-t}y=0;_y=0;_gy=0;get dy(){return this.y-this._y}set dy(t){this._y=this.y-t}rx=0;_rx=0;_grx=0;get drx(){return this.rx-this._rx}set drx(t){this._rx=this.rx-t}ry=0;_ry=0;_gry=0;get dry(){return this.ry-this._ry}set dry(t){this._ry=this.ry-t}b=0;_b=0;get db(){return this.b^this._b}set db(t){this._b=this.b^t}cb(t,r=null){return(this.db&t)!=0&&(r==null?(this.b&t)!=0:(this.b&t)==r)}sx=0;_sx=0;get dsx(){return this.sx-this._sx}set dsx(t){this._sx=this.sx-t}sy=0;_sy=0;get dsy(){return this.sy-this._sy}set dsy(t){this._sy=this.sy-t}get gx(){return this.x-this._gx}get gy(){return this.y-this._gy}get grx(){return this.rx-this._grx}get gry(){return this.ry-this._gry}get g(){return Math.hypot(this.gx,this.gy)}get gr(){return Math.hypot(this.grx,this.gry)}click(t=1){return this.g<t&&this.cb(1,0)}over(t,r=[0,0],e){let n=e??(this._cam.def.c!=null?this._cam.def.c:1),i=(this.x-this._cam.w/2*n+this._cam.x*n*this._cam.sx)*Math.pow(this._cam.sx,-n)-r[0],a=(this.y-this._cam.h/2*n+this._cam.y*n*this._cam.sy)*Math.pow(this._cam.sy,-n)-r[1],s=!1;for(let o=0,p=t.length-1;o<t.length;p=o++){let m=t[o].length==2&&t[p].length==2;if(o==0&&t[p].length==0&&p--,o!=0&&o+1<t.length&&t[o].length==0&&t[o-1].length==2&&t[o+1].length==2){let u=t[o-1][0],c=t[o-1][1],y=u+t[o+1][0],v=c+t[o+1][1];c>a!=v>a&&u>i!=y>i&&(s=!s),o++}else if(m){let u=t[o][0],c=t[o][1],y=t[p][0],v=t[p][1];c>a!=v>a&&i<(y-u)*(a-c)/(v-c)+u&&(s=!s)}}return s}in(...t){for(let r of t)if(this.x>r[0]&&this.x<r[0]+r[2]&&this.y>r[1]&&this.y<r[1]+r[3])return!0;return!1}rin(...t){for(let r of t)if(this.rx>r[0]&&this.rx<r[0]+r[2]&&this.ry>r[1]&&this.ry<r[1]+r[3])return!0;return!1}key={};dkey={};handle(t){if(t instanceof WheelEvent)this.sx+=t.deltaX,this.sy+=t.deltaY;else if(t instanceof MouseEvent){let r=this._cam.dom.getBoundingClientRect(),e=this._cam.w/this._cam.h,n=e>r.width/r.height?[r.width,r.width/e]:[r.height*e,r.height];this.x=(t.clientX-r.left-(r.width-n[0])/2)/n[0]*this._cam.w,this.y=(t.clientY-r.top-(r.height-n[1])/2)/n[1]*this._cam.h,this.rx=(this.x-this._cam.w/2+this._cam.x)/this._cam.sx,this.ry=(this.y-this._cam.h/2+this._cam.y)/this._cam.sy,this.b=t.buttons,this.cb(1)&&(this._gx=this.x,this._gy=this.y,this._grx=this.rx,this._gry=this.ry),t.preventDefault()}else t instanceof KeyboardEvent&&(t.type=="keydown"?this.key[t.key.toLowerCase()]=this.dkey[t.key.toLowerCase()]=Number(t.ctrlKey)+(Number(t.shiftKey)<<1)+(Number(t.altKey)<<2):(delete this.key[t.key.toLowerCase()],this.dkey[t.key.toLowerCase()]=-1))}reset(){this.dx=0,this.dy=0,this.db=0,this.dsx=0,this.dsy=0,this.drx=0,this.dry=0,this.dkey={}}constructor(t){this._eng=t}_eng;bind(t){this._cam=t,addEventListener("wheel",r=>this.handle(r)),addEventListener("mousemove",r=>this.handle(r)),addEventListener("mouseover",r=>this.handle(r)),addEventListener("mousedown",r=>this.handle(r)),addEventListener("mouseup",r=>this.handle(r)),addEventListener("mouseenter",r=>this.handle(r)),addEventListener("mouseout",r=>this.handle(r)),addEventListener("keydown",r=>this.handle(r)),addEventListener("keyup",r=>this.handle(r))}_cam},_=class{static res=[];static depend=[];render(t,r,e){return[]}eng=null;scene=null;constructor(...t){}},R=class{entities=[];add(...t){for(let r of t)r.eng=this.eng,this.entities.push(r)}remove(...t){for(let r=0;r<this.entities.length;r++)t.includes(this.entities[r])&&(this.entities.slice(r,1),r--)}show(t){t?t.scene=this:this.eng.cameras.length&&(this.eng.cameras[0].scene=this)}eng;constructor(t,...r){this.eng=t,this.add(...r)}},Q=class{imgs={};fonts={};audios={};base="";load(t,...r){let e=[];for(let n of r)e.push(...n.res),n.depend.length&&e.push(...this.load(null,...n.depend));return t!=null&&this.load_res(t,...e),e}load_res(t,...r){let e=[],n=!1,i=(s,o)=>{s==-1&&(this.load_err.push(this.base+r[o]),n=!0),e[o][0]=s,t(n?-1:e.map(p=>p[0]/p[1]).reduce((p,m)=>p+m)/e.length)},a=0;for(let s of r){if(s in this.imgs||s in this.fonts||s in this.audios){e.push([0,1]),i(1,a),a++;continue}let o=s.split(".").reverse()[0].toLowerCase();if(["png","jpg","jpeg"].includes(o)){e.push([0,1]);let p=new Image,m=a;p.onload=()=>i(1,m),p.onerror=()=>i(-1,m),p.src=this.base+s,this.imgs[s]=p}else if(["mp3","wav"].includes(o)){e.push([0,1]),this.audios[s]=new Audio;let p=a,m=this.audios[s];m.active=!1,m.oncanplaythrough=()=>i(1,p),m.onerror=()=>i(-1,p),m.src=this.base+s,m.volume=0,m.addEventListener("ended",()=>{m.currentTime=0,m.play()}),m.load()}else if(["ttf","mp3","wav"].includes(o)){e.push([0,5]);let p=a,m=new XMLHttpRequest;m.open("GET",this.base+s),m.responseType="blob",m.onreadystatechange=()=>{if(i(m.readyState,p),m.readyState==4&&m.status!=200)return i(-1,p);if(!(m.readyState!=4||m.status!=200)){if(o=="ttf"){let u=this.fonts[s]=`font_${Object.keys(this.fonts).length}`,c=document.createElement("h1");c.style.font=`20px ${u}`,c.innerHTML=u,c.style.position="fixed",c.style.left="0",c.style.top="100%";let y=document.createElement("style");y.innerHTML+=`@font-face {font-family:"${u}";src:url("${URL.createObjectURL(m.response)}") format("truetype");}`,document.head.appendChild(y),document.body.appendChild(c);let v=F=>{document.fonts.check(`20px ${u}`)?i(5,p):F>1e3?i(-1,p):setTimeout(v,10,F+1)};v(0)}if(["mp3","wav"].includes(o)){this.audios[s]=new Audio;let u=this.audios[s];u.active=!1,u.src=URL.createObjectURL(m.response),u.volume=0,u.addEventListener("ended",()=>{u.currentTime=0,u.play()}),i(5,p)}else i(5,p)}},m.send()}else e.push([0,1]),this.error_add(new Error(`Unknown file type "${o}"`)),i(-1,a);a++}n||t(0)}errors=[];load_err=[];error_add(t){for(let r of this.errors)if(r.message==t.message)return;this.errors.push(t),console.log(t)}cameras=[];inp;debug={m:[1,0,0,1,0,0],_m:[1,0,0,1,0,0],mp:t=>{if(this.inp.key.a!=null&&(this.debug.m[0]-=t*(this.inp.key.a==0?1:this.inp.key.a&2?.25:0)),this.inp.key.d!=null&&(this.debug.m[0]+=t*(this.inp.key.d==0?1:this.inp.key.d&2?.25:0)),this.inp.key.q!=null&&(this.debug.m[1]-=t*(this.inp.key.q==0?1:this.inp.key.q&2?.25:0)),this.inp.key.e!=null&&(this.debug.m[1]+=t*(this.inp.key.e==0?1:this.inp.key.e&2?.25:0)),this.inp.key.x!=null&&(this.debug.m[2]-=t*(this.inp.key.x==0?1:this.inp.key.x&2?.25:0)),this.inp.key.z!=null&&(this.debug.m[2]+=t*(this.inp.key.z==0?1:this.inp.key.z&2?.25:0)),this.inp.key.s!=null&&(this.debug.m[3]-=t*(this.inp.key.s==0?1:this.inp.key.s&2?.25:0)),this.inp.key.w!=null&&(this.debug.m[3]+=t*(this.inp.key.w==0?1:this.inp.key.w&2?.25:0)),this.inp.key.c!=null&&(this.debug.m[4]-=t*(this.inp.key.c==0?4:this.inp.key.c&2?.25:0)),this.inp.key.v!=null&&(this.debug.m[4]+=t*(this.inp.key.v==0?4:this.inp.key.v&2?.25:0)),this.inp.key.r!=null&&(this.debug.m[5]-=t*(this.inp.key.r==0?4:this.inp.key.r&2?.25:0)),this.inp.key.f!=null&&(this.debug.m[5]+=t*(this.inp.key.f==0?4:this.inp.key.f&2?.25:0)),this.inp.key[1]!=null||this.inp.key[2]!=null){let r=Math.PI/16*t*(this.inp.key[1]!=null?1:-1),e=Math.cos(r),n=Math.sin(r),i=[...this.debug.m];this.debug.m=[i[0]*e+i[2]*n,i[1]*e+i[3]*n,i[2]*e-i[0]*n,i[3]*e-i[1]*n,i[4],i[5]]}if(!Object.keys(this.inp.key).length){for(let r=0;r<6;r++)if(this.debug.m[r]!=this.debug._m[r]){console.log("DEBUG MATRIX:",this.debug.m.toString()),this.debug._m=[...this.debug.m];break}}},v:1,vp:t=>{this.inp.key.a!=null&&(this.debug.v-=t*(this.inp.key.a==0?1:this.inp.key.a&2?.25:0)),this.inp.key.d!=null&&(this.debug.v+=t*(this.inp.key.d==0?1:this.inp.key.d&2?.25:0)),console.log(this.debug.v)}};_wait=0;_times=[];_start;get fps(){return this._times.length}set fps(t){this._wait=t?2e3/t:0}scene=null;start_loop(t=!0){let r=performance.now(),e=this._times.length?r-this._times[this._times.length-1]:0;this._times=this._times.filter(i=>r-i<=1e3),this._times.push(r),t&&(this._start=r);for(let i in this.audios)this.audios[i].active=!1;let n=0;for(let i of this.cameras){i.cursor="default",i.clear(),i.fit&&i.fitfull(),i.tolisten=[];let a=[];if(i.scene!=null)for(let p of i.scene.entities){let m=x(p.render(e/1e3,r-this._start,i));for(let u of m)a.push(u)}let s=0,o=0;for(let p=a.length-1;p>=0;p--){let m=a[p];if(!m.hover&&!m.press&&!m.click&&!m.nohover)continue;m.p==null&&(m.p=i.rect(m));let u=!1;this.inp.over(m.p,[m.x??0,m.y??0],m.c??1)&&(o==0&&m.hover&&(m.hover(m),u=!0),s==0&&m.click&&this.inp.click()&&(m.click(m),s++),m.press&&this.inp.b&1&&this.inp.g<1&&m.press(m)),!u&&m.nohover&&m.nohover(m)}i.render({},...a),i.dom.style.cursor=i.cursor,this.loop(e/1e3,r-this._start,i),n++}for(let i in this.audios){let a=this.audios[i];a.active&&a.paused?a.play():!a.active&&!a.paused&&(a.currentTime=0,a.pause())}this.inp.reset(),setTimeout(()=>this.start_loop(!1),this._wait-e>0?this._wait-e:0)}loop=()=>{};constructor(){this.inp=new pt(this),this.start_loop()}};function x(h){if(!h.length)return h;let[t,...r]=h,e=[];for(let n of r)e.push({...t,...n});return e}function ut(h,t,r=0,e=0,n=1,i=1,a="p"){let s=(o,p,m)=>{let u=`${r+p}_${e+m}`,c=0;t[u]&&t[u].data&&t[u].data[a]&&(c=t[u].data[a]);let y=structuredClone(h[c|o]);y.f||(y.f="tile/test.png"),y.data={...t[u]?.data||{},...h[c|o]?.data||{}},y.data[a]=c|o,t[u]=y};for(let o=0;o<n;o++)for(let p=0;p<i;p++)s(15,o,p);for(let o=0;o<n;o++)s(3,o,-1);for(let o=0;o<n;o++)s(12,o,i);for(let o=0;o<i;o++)s(5,-1,o);for(let o=0;o<i;o++)s(10,n,o);s(1,-1,-1),s(2,n,-1),s(4,-1,i),s(8,n,i)}var V=class extends _{per=0;start=()=>{};render(t,r,e){return this.eng==null?[]:[{c:0},...this.per!=1?[{p:[[-100,-10],[],[200,20],[]],b:this.per<0?"red":"white",bz:2,x:e.w/2,y:e.h/2},{a:this.per<0?0:1,p:[[-96,-6],[],[192*this.per,12],[]],f:"white",x:e.w/2,y:e.h/2},{t:this.per<0?"Error loading assets":"Loading...",f:this.per<0?"red":"white",x:e.w/2,y:e.h/2-30},{a:this.per<0?.75:0,t:`failed: ${this.eng.load_err[this.eng.load_err.length-1]}`,tz:15,f:"red",x:e.w/2,y:e.h/2+30}]:[{x:e.w/2,y:e.h/2,t:"Click to start game",f:"white"},{p:[[0,0],[],[e.w,e.h],[]],click:n=>this.start()}]]}};var w=class extends _{static key="";item="";focused=!1;own=1;price=0;on_focused=()=>{};popup=[];x;y;name="Building";base(t,r,e,n=1){this._c+=((this.focused?0:1)-this._c)*t*10;let i=this._c;return{c:i,x:this.x*i+.25*e.w*(1-i),y:this.y*i+.6*e.h*(1-i),s:n*i+1*(1-i),click:a=>{this.focused=!0,this.on_focused(this)}}}_c=1;render_pin(t,r,e,n=1){return this.popup.length==0?[]:[{x:this.x,y:this.y-100},{f:"ui/pin.png",s:.25,oy:.4,click:i=>{this.focused=!0,this.on_focused(this)}},...this.popup]}menu(t,r,e,n){return[]}constructor(t,r,e,n){super(),this.eng=t.eng,this.x=r*72+e*64,this.y=e*36-r*19}};var f=class extends _{name="";quantity=0;price=0;color="";base(t,r,e,n=1){return{c:0}}num(t=0,r=0,e=null){return{t:String(e??this.quantity),x:10+t,y:r-3,b:"#FBE7CD",bz:2,f:"black",tz:10}}menu(t,r,e){return[]}render(t,r,e){return[]}};var Z=class extends f{static res=["item/beef.png"];name="Beef";price=400;color="#D36262";render(t,r,e){return[this.base(t,r,e),{f:"item/beef.png",s:.125,m:[1,0,0,1,0,-90]}]}};var q=class extends f{static res=["item/carrot.png"];name="Carrot";price=130;color="#FF9C53";render(t,r,e){return[this.base(t,r,e),{f:"item/carrot.png",s:.125,m:[1,0,0,1,0,-70]}]}};var A=class extends f{static res=["item/chicken.png"];name="Chicken";price=185;color="#EDC4C4";render(t,r,e){return[this.base(t,r,e),{f:"item/chicken.png",s:.125,m:[1,0,0,1,0,-90]}]}};var C=class extends f{static res=["item/fertilizer.png"];name="Fertilizer";price=32;color="#45231E";render(t,r,e){return[this.base(t,r,e),{f:"item/fertilizer.png",s:.125,m:[1,0,0,1,0,-70]}]}};var L=class extends f{static res=["item/fish.png"];name="Fish";price=175;color="#83D6DC";render(t,r,e){return[this.base(t,r,e),{f:"item/fish.png",s:.125,m:[1,0,0,1,0,-70]}]}};var D=class extends f{static res=["item/garlic.png"];name="Garlic";price=250;color="#fff";render(t,r,e){return[this.base(t,r,e),{f:"item/garlic.png",s:.125,m:[1,0,0,1,0,-70]}]}};var H=class extends f{static res=["item/kadyos.png"];name="Kadyos";price=200;color="#69C72E";render(t,r,e){return[this.base(t,r,e),{f:"item/kadyos.png",s:.125,m:[1,0,0,1,0,-90]}]}};var tt=class extends f{static res=["item/langka.png"];name="Langka";price=100;color="#3B6123";render(t,r,e){return[this.base(t,r,e),{f:"item/langka.png",s:.125,m:[1,0,0,1,0,-90]}]}};var O=class extends f{static res=["item/pork.png"];name="Pork";price=350;color="#EBB5B5";render(t,r,e){return[this.base(t,r,e),{f:"item/pork.png",s:.125,m:[1,0,0,1,0,-90]}]}};var U=class extends f{static res=["item/radish.png"];name="Radish";price=50;color="#C6FAC4";render(t,r,e){return[this.base(t,r,e),{f:"item/radish.png",s:.125,m:[1,0,0,1,0,-90]}]}};var Y=class extends f{static res=["item/soup.png"];name="Soup";price=35;color="#40BE2E";render(t,r,e){return[this.base(t,r,e),{f:"item/soup.png",s:.15,m:[1,0,0,1,0,-60]}]}};var z=class extends f{static res=["item/tomato.png"];name="Tomato";price=80;color="#FF2B2B";render(t,r,e){return[this.base(t,r,e),{f:"item/tomato.png",s:.125,m:[1,0,0,1,0,-90]}]}};var X=class extends f{static res=["item/tuna.png"];name="Tuna";price=270;color="#D83939";render(t,r,e){return[this.base(t,r,e),{f:"item/tuna.png",s:.15,m:[1,0,0,1,0,-60]}]}};var K=class extends f{static res=["item/worm.png"];name="Worm";price=100;color="#793D34";render(t,r,e){return[this.base(t,r,e),{f:"item/worm.png",s:.125,m:[1,0,0,1,0,-90]}]}};var E=[L,Z,q,A,C,D,H,tt,O,U,Y,z,X,K],gt=[{type:"farm",in:[C],out:[q],amount:[1,20],dur:2},{type:"farm",in:[C],out:[D],amount:[1,10],dur:1},{type:"farm",in:[C],out:[H],amount:[1,12],dur:2},{type:"farm",in:[C],out:[z],amount:[1,10],dur:1},{type:"farm",in:[C],out:[U],amount:[1,10],dur:1},{type:"farm",in:[q,z],out:[O],amount:[20,30,50],dur:3},{type:"farm",in:[z,L],out:[A],amount:[10,5,40],dur:3},{type:"fish",in:[K],out:[L],amount:[1,50],dur:1},{type:"factory",in:[L],out:[X],amount:[1,2],dur:1},{type:"factory",in:[z],out:[Y],amount:[3,1],dur:1}];var lt=class{money=0;own=[];items=E.map(t=>new t);item_prices=[];item_demand=[];item=[];saving=0;loan=0;logs=[[],[]];last=0;day=40;update(){}get_item(t){for(let r of this.item)if(r.constructor==t.constructor)return r;return null}loaned(t){if(t<0&&this.money<-t)return k([{t:"Insufficent funds ",f:"#F44336",tz:15}]);if(this.loan>1e5&&t>0)return k([{t:"Reached Max loaned",f:"#F44336",tz:15}]);this.loan+t>1e5&&(k([{t:"Reached Max loaned",f:"black",tz:15}]),t=1e5-this.loan),this.money+=t,this.loan+=t}saved(t){if(t<0&&this.saving<-t)return k([{t:"Insufficent savings ",f:"#F44336",tz:15}]);if(this.money<t)return k([{t:"Insufficent funds",f:"#F44336",tz:15}]);this.money-=t,this.saving+=t}building(t,r){if(!r){let e=0;for(let n of this.own)if(n==t){this.money+=t.price,t.price=Math.round(t.price*.95),t.own=1,this.own.splice(e,1);return}else e++;return k([{t:"Failure",f:"#F44336",tz:15}])}if(this.money<t.price)return k([{t:"Insufficent funds",f:"#F44336",tz:15}]);this.money-=t.price,t.price=Math.round(t.price*.95),t.own=2,this.own.push(t)}buy(t){if(this.money<t.price)return k([{t:"Cant afford",f:"#F44336",tz:15}]);for(let r of this.item)if(r.constructor==t.constructor){this.money-=t.price,r.quantity++;return}k([{t:"Unknown item",f:"#F44336",tz:15}])}process(t){let r=-1;if((r=this.processes.indexOf(t))!=-1)return t.ongoing==!0?(k([{t:"Cant cancel",f:"#F44336",tz:15}]),!1):(t.in.forEach((e,n)=>{let i=this.get_item(e);i&&(i.quantity+=t.amount[n])}),this.processes.splice(r,1),!0);for(let e=0;e<t.in.length;e++){let n=l.get_item(t.in[e]);if(n==null)return k([{t:"Unknown item",f:"#F44336",tz:15}]),!1;if(n.quantity<t.amount[e])return k([{t:`Lacking ${n.name}`,f:"#F44336",tz:15}]),!1}for(let e=0;e<t.in.length;e++){let n=l.get_item(t.in[e]);n.quantity-=t.amount[e]}return t.left=t.dur,this.processes.push(t),!0}processes=[];next(){this.day--,this.logs[0].push(this.saving),this.logs[1].push(this.loan),this.loan=Math.round(this.loan*1.08),this.saving=Math.round(this.saving*1.05),this.items.forEach((r,e)=>{let n=Math.round(r.quantity/2+1.5*r.quantity*Math.random());r.price=Math.round(r.price+this.k*(this.item_demand[e]-n)/r.quantity),r.quantity=Math.round(Math.max(100+(25-50*Math.random()),Math.round(r.quantity*2*Math.random()))),this.item_prices[e].push(r.price)}),console.log(this.processes);let t=0;for(let r of this.processes){if(r.left--,r.left<=0){let e=-1;for(let n of r.out){let i=this.get_item(n);e++,i!=null&&(i.quantity+=r.amount[r.in.length+e])}r.ongoing=r.on=!1,r.left=r.dur,this.processes.splice(t--,1)}else r.ongoing=!0;t++}}k=2;constructor(){this.items.forEach(t=>{t.quantity=Math.round(500*Math.random()+1e3*Math.random()),this.item_prices.push([t.price]),this.item_demand.push(Math.round(t.quantity/2+1.5*t.quantity*Math.random()))})}},l=new lt;for(let h=0;h<30;h++)l.next();var et=class extends _{name="";msg=[];get chat_txt(){return this.msg.length?this.msg[0][0]:""}get chat_num(){return this.msg.length?this.msg[0][1]:0}next(){this.msg.shift()}menu(t,r,e){return[]}render(t,r,e){return[]}};var T=class extends et{static res=["people/mentor_body.png","people/mentor_head.png"];name="Mentor";render(t,r,e){let n=this.chat_num&3,i=this.chat_num>>2&3;return[{c:0},{f:"people/mentor_body.png",s:.25,crop:[900*(n%2),900*Math.floor(n/2),900,900],y:Math.sin(r/150+Math.PI/2)},{f:"people/mentor_head.png",s:.25,crop:[900*(i%2),900*Math.floor(i/2),900,900],y:-60+Math.sin(r/150)}]}};var bt=[T];function b(h,t,r=1,e=1,n=0){let i=[];"t"in h&&(i.push({t:h.t,tz:h.tz??20,b:"black",bz:h.bz??4,x:h.x??0,y:(h.y??0)+3,f:h.f??"white"}),delete h.t,delete h.tz,delete h.f,delete h.bz),"f"in h&&(i.push({f:h.f,x:(h.x??0)+(h.data?.x??0),y:(h.y??0)+(h.data?.y??0),s:.25,o:h.o??"",r:h.r??0,a:(n&3)==3?.5:1}),delete h.f,delete h.r);let a=h.click;return"click"in h&&delete h.click,h.click=s=>{s.data&&s.data.disabled||(s.data?.button&&t.play("sfx/button.mp3",.25),a&&a(s))},[{f:(n&3)==3?"ui/button_disabled.png":(n&3)==2?"ui/button_down.png":"ui/button_up.png",s:.25,crop:(n&4)==4?[49,48,49,48,46,45,r,e,11,11]:[60,59,60,59,57,56,r,e],press:s=>{s.data&&s.data.button&&(s.f="ui/button_down.png")},...h,data:{...h.data??{},button:(n&3)==0,disabled:(n&3)==3}},...i]}var G=class h extends _{static res=["coins.png","ui/title.png","ui/resume.png","ui/options.png","ui/exit.png","ui/close.png","ui/menu.png","ui/bag.png","ui/next.png","font/emulogic.ttf","music/bgm1_prototype.wav","sfx/button.mp3","sfx/whoosh.mp3","ui/button_up.png","ui/button_down.png","ui/button_disabled.png","plan.png","ui/arrow.png","ui/arrow_off.png"];static depend=[...E,...bt];pop=[];pop_c=0;pop_t=0;help=0;help_c=0;chat=null;closed=()=>{};popup(t){this.pop=t,this.pop_t=0}focused=()=>{};tutorial=1;menu=0;m=0;focus=null;title="Inventory";sprites=[];render(t,r,e){if(this.eng==null)return[];if(this.pop_c+=((this.pop.length?1:0)-this.pop_c)*t*10,this.pop.length&&this.pop_t==0){this.pop_t=performance.now();for(let s of this.pop)s.c=s.c??0}this.pop.length&&performance.now()-this.pop_t>3e3&&(this.pop=[]),this.help_c+=(this.help-this.help_c)*t*10,this.eng.inp.dkey.q==0&&(this.help=1-this.help),this.m+=(this.menu-this.m)*t*10,this.menu!=2&&this.focus!=null&&Math.abs(this.m-2)>.99&&(this.focus=null),this.chat&&!this.chat.msg.length&&(this.chat=null);let n=(...s)=>s.map(o=>Math.max(0,1-Math.abs(this.m-o))).reduce((o,p)=>o+p,0),i=Math.floor(r/200)%4,a=(s,o=1,p=1,m=0)=>b(s,e,o,p,m);return[{c:0,hover:s=>{s.click&&(s.cur="pointer")},tf:"font/emulogic.ttf"},{f:"music/bgm1_prototype.wav"},{f:"black",p:[[0,0],[],[e.w,e.h]],a:.5*n(0,2),click:this.menu==1?void 0:()=>{}},...this.focus==null?[]:x(this.focus.render(t,r,e)),{x:e.w*.5,y:e.h*.25*(2*n(0)-1),f:h.res[1],s:.35},{f:"coins.png",x:(e.w*.72+25)*n(0)-50*n(0)+25,y:(e.h*.2+25)*n(0)-50*n(0)+25,crop:[Math.abs(2-i)*22,0,22,23],sx:i==1?-1.5:1.5,sy:1.5},{t:String(l.money),tz:20,x:44,y:28-38*n(0),o:"w",f:"gold",b:"black",bz:4},{t:`${l.day} days left`,tz:15,x:e.w-130,y:28-38*n(0,2),o:"e",f:"white",b:"black",bz:5},{t:String(this.eng.fps),o:"nw",tz:8},...a({x:e.w/2,y:e.h-200*n(0)+50,t:"resume",f:"#4CAF50",click:s=>this.menu=1},10,2),...a({x:e.w/2,y:e.h-200*n(0)+105,t:"options",f:"#2196F3"},10,2),...a({x:e.w/2,y:e.h-200*n(0)+160,t:"exit",f:"#F44336"},10,2),...a({x:e.w+30-40*n(1),y:10,o:"ne",f:"ui/menu.png",click:s=>this.menu=0,data:{x:-3,y:9}}),...a({x:e.w+30-80*n(1),y:10,o:"ne",f:"ui/bag.png",click:s=>{this.title="Inventory",this.menu=2},data:{x:-7,y:7}}),...a({x:e.w+30-120*n(1),y:10,o:"ne",f:"ui/next.png",click:s=>{l.next()},data:{x:-10,y:9}}),...a({x:e.w+70-80*n(2),y:10,o:"ne",f:"ui/close.png",click:s=>{this.closed(),this.focus&&(this.focus.focused=!1),this.menu=1},data:{x:-4,y:6}}),...this.focus==null||this.title.toLowerCase()=="inventory"?[...a({x:e.w/2,y:e.h+150-(e.h/2+135)*n(2)},40,20,1),...Array(32).fill(0).map((s,o)=>{let p=o%8,m=Math.floor(o/8);return{c:0,f:"ui/button_down.png",s:.25,crop:[60,59,60,59,57,56,3,3],x:75+70*p,y:90+70*m+(e.h-50)*(1-n(2))}}),...l.own.map((s,o)=>{let p=o%8,m=Math.floor(o/8);return[...x(s.render(t,r,e)).map(u=>(u.c=0,u.x=75+70*p,u.y=100+70*m+(e.h-50)*(1-n(2)),u.s=.25,u.click=void 0,u)),{c:0,x:75+70*p,y:90+70*m+(e.h-50)*(1-n(2)),p:[[-28,-28],[],[58,57],[]],click:u=>{e.x=s.x,e.y=s.y,this.menu=1}}]}).flat(),...l.item.map((s,o)=>{let p=(o+l.own.length)%8,m=Math.floor((o+l.own.length)/8);return[...x(s.render(t,r,e)).map(u=>(u.x=75+70*p,u.y=100+70*m+(e.h-50)*(1-n(2)),u)),s.num(75+70*p,110+70*m+(e.h-50)*(1-n(2)))]}).flat()]:[...a({x:e.w+150-(e.w/2+5)*n(2),y:e.h/2+15},20,19,1),...a({x:e.w/4,y:e.h+25-(e.h/8+25)*n(2),...[{t:"Cant Own",f:"#F44336"},{t:"Purchase",f:"#4CAF50",click:s=>{this.focus instanceof w&&l.building(this.focus,!0)}},{t:"Sell",f:"#2196F3",click:s=>{this.focus instanceof w&&l.building(this.focus,!1)}}][this.focus.own]??{t:"Unknown",f:"#F44336"}},15,2),...this.focus.price?[{t:`\u20B1${this.focus.price}`,x:e.w/4,y:e.h+25-(e.h/4+15)*n(2),f:"white",a:.75}]:[],...this.focus.menu(t,r,e,n(2)).map(s=>(s.c=s.c??0,s.x=(s.x??0)+e.w+150-(e.w/2+5)*n(2),s.y=(s.y??0)+e.h/2+15,s))],...this.chat!=null?[...x(this.chat.render(t,r,e)).map(s=>(s.x=(s.x??0)+13*e.w/16,s.y=(s.y??0)+9*e.h/16+500*(1-n(1)),s)),...a({x:e.w/2,y:e.h-45+500*(1-n(1)),click:s=>this.chat?.next()},40,6),{t:this.chat.name,x:35,y:e.h-85+500*(1-n(1)),o:"nw"},...this.chat.chat_txt.split(`
`).map((s,o)=>({t:s,x:35,y:e.h-50+500*(1-n(1))+20*o,o:"nw",tz:15,a:.75}))]:[],...this.title.toLowerCase()=="inventory"?[{t:this.title,tz:20,b:"black",bz:4,x:e.w/2,y:28*n(2)-10*(1-n(2)),f:"skyblue"}]:[{t:this.title,tz:15,b:"black",bz:4,x:e.w/4,y:70*n(2)-10*(1-n(2)),f:"skyblue"}],...a({x:e.w/2,y:50*this.pop_c-30,click:s=>this.pop=[]},22,3),...this.pop.map(s=>(s.x=e.w/2,s.y=50*this.pop_c-25,s)),{f:"plan.png",o:"nw",s:.5,y:e.h*(1-this.help_c)}]}};var it=class extends w{static res=["building/bank.png"];static key="bank";item="building/bank.png";own=0;name="DBO Bank";act_loan_pay=!1;act_save_out=!1;render(t,r,e){return[this.base(t,r,e),{f:"building/bank.png",p:[[-62,-100],[],[133,130],[]],m:[1,0,0,1,4,-32]}]}menu(t,r,e){let n=[...l.logs[0],l.saving],i=[...l.logs[1],l.loan],a=Math.max(100,Math.max(...n,...i));return[...b({x:0,y:-98},e,19,4,2),{p:n.length<2?[[0,55*(1-(n[0]??0)/a)],[270,55*(1-(n[0]??0)/a)]]:n.map((s,o)=>[270*o/(n.length-1),55*(1-s/a)]),b:"green",x:-135,y:-125,bz:2,a:.5},{p:i.length<2?[[0,55*(1-(i[0]??0)/a)],[270,55*(1-(i[0]??0)/a)]]:i.map((s,o)=>[270*o/(i.length-1),55*(1-s/a)]),b:"red",x:-135,y:-125,bz:2,a:.5},{t:"Savings (5% rate)",o:"w",x:-140,y:-30,f:"black",tz:10,a:.75},{t:String(l.saving),o:"w",x:-140,y:-10,f:"black",tz:15},...b({x:-100,y:15,t:"1,000",tz:15,f:"black",bz:0,click:s=>l.saved(1e3*(this.act_save_out?-1:1))},e,5,1),...b({x:0,y:15,t:"10,000",tz:15,f:"black",bz:0,click:s=>l.saved(1e4*(this.act_save_out?-1:1))},e,6,1),...b({x:100,y:15,t:"100k",tz:15,f:"black",bz:0,click:s=>l.saved(1e5*(this.act_save_out?-1:1))},e,5,1),...b({x:90,y:-20,t:this.act_save_out?"deposit":"withdraw",tz:10,f:"black",bz:0,click:s=>this.act_save_out=!this.act_save_out},e,6,1),{t:"Loans (8% rate)",o:"w",x:-140,y:70,f:"black",tz:10,a:.75},{t:String(l.loan),o:"w",x:-140,y:90,f:"black",tz:15},...b({x:-100,y:115,t:"1,000",tz:15,f:"black",bz:0,click:s=>l.loaned(1e3*(this.act_loan_pay?-1:1))},e,5,1),...b({x:0,y:115,t:"10,000",tz:15,f:"black",bz:0,click:s=>l.loaned(1e4*(this.act_loan_pay?-1:1))},e,6,1),...b({x:100,y:115,t:"100k",tz:15,f:"black",bz:0,click:s=>l.loaned(1e5*(this.act_loan_pay?-1:1))},e,5,1),...b({x:90,y:80,t:this.act_loan_pay?"take loan":"pay back",tz:10,f:"black",bz:0,click:s=>this.act_loan_pay=!this.act_loan_pay},e,6,1)]}};var rt=class extends w{static res=["building/blank_mask.png"];static key="blank";item="building/blank_mask.png";own=0;name="Private building";color=["white","white","white"];render(t,r,e){let n=this.base(t,r,e);return[{x:n.x??0,y:n.y??0,c:n.c??1},{p:[[-45,-33],[0,-7],[50,-20],[50,11],[0,24],[-38,2],[-45,0],[]],f:this.color[0]},{p:[[-45,-65],[0,-39],[50,-52],[50,-20],[0,-7],[-45,-33],[]],f:this.color[1]},{p:[[-49,-69.5],[8,-85],[54,-58],[54,-54],[53,-53],[53,-50],[0,-36],[-47,-64],[-47,-65],[-49,-67],[]],f:this.color[2]},{f:"building/blank_mask.png",p:[[-48,-85],[],[102,110],[]],m:[1,0,0,1,0,-30],...n}]}d=100;constructor(t,r,e,n){super(t,r,e,n),n.color?.length==3?this.color=n.color:this.color=Array(3).fill("").map(i=>`rgb(${255-this.d+this.d*Math.random()},${255-this.d+this.d*Math.random()},${255-this.d+this.d*Math.random()})`)}menu(t,r,e){return[{t:"You cant own this",tz:15,a:.5}]}};var nt=class extends w{static res=["building/callereal.png","ui/triangle.png"];static key="callereal";static depend=E;item="building/callereal.png";own=0;name="Calle Real";page=0;highlight=-1;render(t,r,e){return[this.base(t,r,e),{f:"building/callereal.png",p:[[-85,-140],[],[185,160],[]],m:[1,0,0,1,0,-60]}]}menu(t,r,e,n){let i=Math.max(...l.item_prices.slice(4*this.page,4*(this.page+1)).flat());return[...b({x:0,y:-98},e,19,4,2),...l.item_prices.slice(4*this.page,4*(this.page+1)).map((a,s)=>({p:a.length<2?[[0,55*(1-(a[0]??0)/i)],[270,55*(1-(a[0]??0)/i)]]:a.map((o,p)=>[270*p/(a.length-1),55*(1-o/i)]),b:this.highlight==s?"red":l.item[4*this.page+s].color||["red","yellow","green","blue"][s],x:-135,y:-125,bz:this.highlight==s?3:2,a:this.highlight==s?1:.5})),...l.items.slice(4*this.page,4*(this.page+1)).map((a,s)=>[...b({x:0,y:-36+48*s,hover:o=>{this.highlight=s},click:o=>{l.buy(a)}},e,19,2),...x(a.render(t,r,e)).map(o=>(o.x=-120,o.y=-26+48*s,o)),{t:a.name,x:-100,y:-46+48*s,o:"nw",tz:15},{t:String(a.price),x:130,y:-35+48*s,o:"e",tz:15,a:.75},{t:String(a.quantity),x:-100,y:-20+48*s,o:"sw",tz:10,a:.75}]).flat(),...b({x:-170+40*(1-n),y:50,f:"ui/triangle.png",r:-Math.PI/2,click:a=>{this.page--}},e,1,1,this.page>0?0:3),...b({x:-170+40*(1-n),y:80,f:"ui/triangle.png",r:Math.PI/2,click:a=>{this.page++}},e,1,1,this.page*4+4<l.items.length?0:3),{p:[[-142,-57],[],[285,187],[]],nohover:a=>{this.highlight=-1}}]}};var I=class extends w{static res=["ui/arrow.png","ui/arrow_off.png"];page=0;type="";processes=[];setted_process=!1;set_process(){this.type!=""&&(this.processes=gt.reduce((t,r,e)=>(r.type==this.type&&t.push({id:e,in:r.in.map(n=>new n),out:r.out.map(n=>new n),amount:r.amount,dur:r.dur,left:r.dur,on:!1,ongoing:!1}),t),[]),this.setted_process=!0)}menu(t,r,e,n){this.setted_process||this.set_process();let i=l.own.includes(this),a;return[...i?[...x((a=l.item.filter(s=>s.name=="Fertilizer")[0]).render(t,r,e)).map(s=>(s.x=-130,s.y=-115,s.s=(s.s??1)*.75,s)),a.num(-130,-105),...this.processes.slice(this.page*5,5*(this.page+1)).map((s,o)=>[...b({x:0,y:-82+48*o,click:p=>{l.process(s)&&(s.on=!s.on)}},e,19,2,s.ongoing?3:0),...s.in.map((p,m)=>[...x(p.render(t,r,e)).map(u=>(u.x=-120+35*m,u.y=-73+48*o,u)),p.num(-120+35*m,-73+48*o,s.amount[m])]).flat(),...s.out.map((p,m)=>[...x(p.render(t,r,e)).map(u=>(u.x=70+35*m,u.y=-73+48*o,u)),p.num(70+35*m,-73+48*o,s.amount[s.in.length+m])]).flat(),{f:s.on?"ui/arrow.png":"ui/arrow_off.png",s:.125,y:-72+48*o},{t:s.on?`${s.left} days left`:`${s.dur} days`,y:-85+48*o,tz:10}]).flat()]:[{t:"You dont own this",tz:15,a:.5}],...b({x:-170+40*(1-n),y:50,f:"ui/triangle.png",r:-Math.PI/2,click:s=>{this.page--}},e,1,1,this.page<=0||!i?3:0),...b({x:-170+40*(1-n),y:80,f:"ui/triangle.png",r:Math.PI/2,click:s=>{this.page++}},e,1,1,this.page*5+5>=this.processes.length||!i?3:0)]}};var st=class extends I{static res=["building/factory.png"];static key="factory";item="building/factory.png";name="Factory";price=6e4;type="factory";render(t,r,e){return[this.base(t,r,e),{f:"building/factory.png",p:[[-75,-125],[],[165,145],[]],m:[1,0,0,1,0,-50]}]}};var ot=class extends I{static res=["building/farm.png","ui/arrow.png","ui/arrow_off.png"];static key="farm";item="building/farm.png";name="Farm";price=5e4;type="farm";render(t,r,e){return[this.base(t,r,e),{f:"building/farm.png",p:[[-64,-49],[],[120,97],[]],m:[1,0,0,1,0,-10]}]}};var at=class extends I{static res=["building/fishing.png"];static key="fishing";item="building/fishing.png";name="Fishing Area";price=5e4;type="fishing";render(t,r,e){return[this.base(t,r,e,.75),{f:"building/fishing.png",m:[1,0,0,1,5,-35],p:[[-70,-80],[],[145,110],[]]}]}};var yt=[it,rt,nt,st,ot,at];var N=class h extends _{static res=["tile/grass_0.png","tile/sand_0.png","tile/sand1.png","tile/water_0.png","tile/water_1.png","tile/ws_x_0.png","tile/ws_y_0.png","tile/ws_xy_0.png","tile/ws__0.png","tile/ws_x_1.png","tile/ws_y_1.png","tile/ws_xy_1.png","tile/ws__1.png","tile/sg_x_0.png","tile/sg_y_0.png","tile/sg_xy_0.png","tile/sg__0.png","tile/test.png","road/dirt.png","road/dirt_empty.png","road/cement.png","road/cement_empty.png","prop/tree.png","prop/bush.png","prop/coconut.png","tile/water_bg_0.png","tile/water_bg_1.png","ui/pin.png"];static depend=yt;ly=[{},{}];focused=()=>{};generate(t=[]){this.ly=[{},{}];let[r,e]=this.ly;for(let n of t){let i=!0,a=`${n.x}_${n.y}`;if(n.w==null&&(n.w=1),n.h==null&&(n.h=1),n.type=="sand")ut([{},{data:{pre:"ws_xy"},m:[.312,.463,-2.45,-.23,-1,1]},{data:{pre:"ws_xy"},m:[-1,0,0,-1,-1,1]},{data:{pre:"ws_y"},m:[-1,0,0,-1,-1,1]},{data:{pre:"ws_xy"}},{data:{pre:"ws_x"}},{},{data:{pre:"ws_"},m:[-.2404,-.45704,2.5288,.2536,0,0]},{data:{pre:"ws_xy"},m:[-.355,.37,2.31,.38,-1,1]},{},{data:{pre:"ws_x"},m:[-1,0,0,-1,-1,1]},{data:{pre:"ws_"},m:[1,0,0,1,-2,0]},{data:{pre:"ws_y"}},{data:{pre:"ws_"},m:[.95175,.235,.275,-.951,0,.6285]},{data:{pre:"ws_"},m:[.26139,.4746,-2.4687,-.27096,4.952,2.076]},{data:{pre:"sand"}}],r,n.x,n.y,n.w,n.h);else if(n.type=="grass")ut([{},{data:{top:"sg_xy"},m:[.312,.463,-2.45,-.23,-1,1]},{data:{top:"sg_xy"},m:[-1,0,0,-1,-1,1]},{data:{top:"sg_y"},m:[-1,0,0,-1,-1,1]},{data:{top:"sg_xy"}},{data:{top:"sg_x"}},{},{data:{top:"sg_"},m:[-.2404,-.45704,2.5288,.2536,0,0]},{data:{top:"sg_xy"},m:[-.355,.37,2.31,.38,-1,1]},{},{data:{top:"sg_x"},m:[-1,0,0,-1,-1,1]},{data:{top:"sg_"},m:[1,0,0,1,-2,0]},{data:{top:"sg_y"}},{data:{top:"sg_"},m:[.95175,.235,.275,-.951,0,.6285]},{data:{top:"sg_"},m:[.26139,.4746,-2.4687,-.27096,4.952,2.076]},{data:{top:"grass"}}],r,n.x,n.y,n.w,n.h,"pt");else if(n.type=="dirt")for(let s=0;s<n.w;s++){let o=`${n.v?n.x:n.x+s}_${n.v?n.y+s:n.y}`;o in e?e[o]={f:"road/dirt_empty.png",m:[1.33725,-.071745,-.24675,1.2205,0,0]}:o in r&&(e[o]={f:"road/dirt.png",m:n.v?[1.33725,-.071745,-.24675,1.2205,0,0]:[-1.27025,-.39275,0,1.2135,0,0]})}else if(n.type=="cement")for(let s=0;s<n.w;s++){let o=`${n.v?n.x:n.x+s}_${n.v?n.y+s:n.y}`;o in e?e[o]={f:"road/cement_empty.png",m:[1.33725,-.071745,-.24675,1.2205,0,0]}:o in r&&(e[o]={f:"road/cement.png",m:n.v?[1.33725,-.071745,-.24675,1.2205,0,0]:[-1.27025,-.39275,0,1.2135,0,0]})}else if(n.type=="tree")e[a]={f:"prop/tree.png",m:[1,0,0,1,0,-25]};else if(n.type=="forest"){n.d==null&&(n.d=1);for(let s=0;s<n.h*n.d;s++)for(let o=0;o<n.w*n.d;o++){let p=[n.x+o/n.d+(Math.random()-.5)/2,n.y+s/n.d+(Math.random()-.5)/4],m=`${Math.round(p[0])}_${Math.round(p[1])}`;e[`${p[0]}_${p[1]}`]=m in r&&r[m].data?.top=="grass"?{f:"prop/tree.png",m:[1,0,0,1,0,-25]}:{f:"prop/coconut.png",s:.0625,m:[1,0,0,1,0,-350]}}}else n.type=="bush"?e[a]={f:"prop/bush.png",s:1}:n.type=="test"?e[a]={f:"tile/test.png",a:.5}:i=!1;if(!i){for(let s of h.depend)if(n.type==s.key){let o=new s(this,n.x,n.y,n);o.on_focused=p=>this.focused(p),e[a]={data:{build:o}},i=!0}}i||this.eng?.error_add(new Error(`Unknown type "${n.type}`))}for(let n in this.ly)for(let i in this.ly[n]){let a=i.split("_").map(o=>Number(o)),s=this.ly[n][i];Object.assign(s,{x:a[0]*72+a[1]*64,y:a[1]*36-a[0]*19}),n=="0"&&s.data?.pre&&(s.f=`tile/${s.data.top||s.data.pre}_0.png`)}}init=!0;render(t,r,e){e.tile({f:e.sx<.3?"#72C1E0":`tile/water_bg_${Math.floor(r/800)%2}.png`,s:.5});for(let n in this.ly[0]){let i=this.ly[0][n];i.data&&i.data.pre&&i.data.pre[0]=="w"&&!i.data.top&&(i.f=`tile/${i.data.pre}_${Math.floor(r/800)%2}.png`)}return[{hover:n=>{n.click&&(n.cur="pointer")}},...Object.values(this.ly[0]),...Object.values(this.ly[1]).map(n=>{if(n.data?.build){let i=n.data.build;return[...x(i.render(t,r,e)),...x(i.render_pin(t,r,e))]}return[n]}).reduce((n,i)=>[...n,...i],[])]}};var xt=[{type:"sand",x:-10,y:-10,w:20,h:20},{type:"grass",x:-9,y:-5,w:18,h:14},{type:"fishing",x:7,y:9},{type:"dirt",x:3,y:-8,w:16,v:!0},{type:"cement",x:-8,y:1,w:16},{type:"bank",x:2,y:0},{type:"tree",x:1.3,y:.3},{type:"callereal",x:0,y:0},{type:"factory",x:-5,y:0},{type:"blank",x:5,y:0,color:["blue","brown","violet"]},{type:"blank",x:4,y:0,color:["red","yellow","green"]},{type:"bush",x:-2,y:0},{type:"farm",x:-2,y:0},{type:"tree",x:0,y:3},{type:"bush",x:-5,y:5},{type:"forest",x:-8,y:-8,w:5,h:5}];var $=new Q,ht=new J("#game",$);$.base="/assets/";ht.fit=!0;ht.scale(4);for(let h of E)l.item.push(new h);var ft=new V,wt=new R($,ft);$.load(h=>{ft.per=h,h==1&&_t.show()},G,N);wt.show();ft.start=()=>{ht.full(),_t.show()};var dt=new N($),B=new G,_t=new R($,dt,B);dt.generate(xt);dt.focused=h=>{ht.play("sfx/whoosh.mp3",.25,.4),B.title=h.name,B.menu=2,B.focus=h};function k(h){return B.popup(h)}B.menu=1;var kt=new T;kt.msg=[[`Good morning my new apprentice and
welcome to Iloilo!`,0],[`You must take advantage of the
upcoming Dinagyang festival in ${l.day} days`,5]];$.loop=(h,t,r)=>{let e=$.inp;if(l.update(),B.menu==1){if(e.dsy){let n=Math.max(.25,Math.min(8,r.sx*Math.pow(1.5,-e.dsy/100)));r.s=n}if(e.cb(1)&&e.dx&&e.dy,e.b&1){r.x-=e.dx/r.sx,r.y-=e.dy/r.sy;let n=1300*Math.min(1,r.sx),i=600*Math.min(1,r.sy);r.x=Math.min(n,Math.max(-n,r.x)),r.y=Math.min(i,Math.max(-i,r.y))}}};})();</script></body></html>