<!DOCTYPE html><html><head><title>Noble City</title><style>html,body{background-color:#111;width:100%;height:100%;margin:0;padding:0;overflow:hidden;display:flex;justify-content:center;align-items:center;}canvas{display:block;image-rendering:pixelated;object-fit:contain;box-shadow:0 0 30px #000}</style></head><body><canvas id="game"></canvas><script>(()=>{var N=class{x=0;y=0;sm=1;get w(){return Math.floor(this.dom.width/this.sm)}set w(e){this.dom.width=e}get h(){return Math.floor(this.dom.height/this.sm)}set h(e){this.dom.height=e}set s(e){this.sx=e,this.sy=e}sx=1;sy=1;scale(e){this.dom.width*=e,this.dom.height*=e,this._ctx=this.dom.getContext("2d"),this._ctx.imageSmoothingEnabled=!1,this._ctx.scale(e,e),this.sm*=e}full(){document.body.requestFullscreen()}def={bz:1};cursor="default";tolisten=[];render(e={},...r){let i=this._eng;r.length||(r=[e],e={});for(let n of r){this._ctx.save();let t={};if(Object.assign(t,this.def,e,n),(t.click||t.hover||t.press)&&t.p!=null&&this.tolisten.push(t),t.f&&t.f in i.audios){i.audios[t.f].active=!0,i.audios[t.f].volume=t.a??1;continue}let a=t.f!=null&&!(t.f in i.imgs),s=t.b!=null&&!(t.b in i.imgs),o=t.crop!=null&&t.crop.length==4,h=t.crop!=null&&t.crop.length>=8;if(a&&(this._ctx.fillStyle=t.f),s&&(this._ctx.strokeStyle=t.b),this._ctx.lineCap=t.be=="arc"?"round":t.be=="sqr"?"square":"butt",this._ctx.lineJoin=t.bj=="arc"?"round":t.bj=="sqr"?"bevel":"miter",this._ctx.lineWidth=t.bz??1,t.a==0){this._ctx.restore();continue}this._ctx.globalAlpha=t.a??1,t.c=t.c??1;let[m,u]=[Math.pow(this.sx,t.c),Math.pow(this.sy,t.c)];t.sx=(t.sx??t.s??1)*m,t.sy=(t.sy??t.s??1)*u;let[g,y]=t.r?[Math.sin(t.r),Math.cos(t.r)]:[0,1],[k,B]=[this.w/2*t.c*Math.pow(this.sx,t.c-1)+this.x*(1-t.c-m)+(t.x??0)*m,this.h/2*t.c*Math.pow(this.sy,t.c-1)+this.y*(1-t.c-u)+(t.y??0)*u],pe=this.rect(t);if(this._ctx.transform(t.sx*y,t.sx*g,-t.sy*g,t.sy*y,k,B),t.m&&t.m.length==6?this._ctx.transform.apply(this._ctx,t.m):t.m&&i.error_add(new Error(`Invalid transform [${t.m.toString()}]`)),this._ctx.translate(pe[0][0]/t.sx,pe[0][1]/t.sy),t.f&&!a){let d=t.crop&&o?[t.crop[2],t.crop[3]]:t.crop&&h?[t.crop[4]*(t.crop[6]+1),t.crop[5]*(t.crop[7]+1)]:[this._eng.imgs[t.f].width,this._eng.imgs[t.f].height];if(d=[Math.abs(d[0]*t.sx*y),Math.abs(d[1]*t.sy*y)],this.w+d[0]<k||this.h+d[1]<B||k+d[0]<0||B+d[1]<0){this._ctx.restore();continue}}if(t.f!=null&&t.f in i.imgs){if(t.crop&&o)this._ctx.drawImage(i.imgs[t.f],t.crop[0],t.crop[1],t.crop[2],t.crop[3],0,0,t.crop[2],t.crop[3]);else if(t.crop&&h){let d=t.crop[2]*(t.crop[6]%1||1),C=t.crop[4]*(t.crop[6]%1||1),b=t.crop[3]*(t.crop[7]%1||1),G=t.crop[5]*(t.crop[6]%1||1),S=Math.ceil(t.crop[6]),fe=Math.ceil(t.crop[7]);for(let P=0;P<=S;P++)for(let F=0;F<=fe;F++)this._ctx.drawImage(i.imgs[t.f],(t.crop[0]+t.crop[2]-d)*(P==0?0:P==S?1:.5)+(t.crop[8]??0),(t.crop[1]+t.crop[3]-b)*(F==0?0:F==fe?1:.5)+(t.crop[9]??0),d,b,C*P,G*F,d,b)}else this._ctx.drawImage(i.imgs[t.f],0,0);t.p=t.p??pe}if(t.p){let d=0,C=0;this._ctx.beginPath();for(let b of t.p)b.length==2&&!d?this._ctx.moveTo(b[0],b[1]):b.length==2&&C==1?(this._ctx.lineTo(t.p[d-2][0]+b[0],t.p[d-2][1]),this._ctx.lineTo(t.p[d-2][0]+b[0],t.p[d-2][1]+b[1]),this._ctx.lineTo(t.p[d-2][0],t.p[d-2][1]+b[1])):b.length==2?this._ctx.lineTo(b[0],b[1]):b.length==0&&d>0&&t.p[d-1].length==2&&d+1!=t.p.length&&t.p[d+1].length==2?C=1:b.length==0&&d+1==t.p.length&&this._ctx.closePath(),d++;s&&this._ctx.stroke(),a&&(t.bz??1)&&this._ctx.fill()}if(t.t){let d=t.tz??20,[C,b]=[0,0],[G,S]=[!1,!1];this._ctx.font=`${d}px ${t.tf&&t.tf in i.fonts?i.fonts[t.tf]:t.tf??"Arial"}`,(G=[0,.5,1].includes(t.ox))&&(this._ctx.textAlign=t.ox==0?"start":t.ox==1?"end":"center"),(S=[0,.5,1].includes(t.oy))&&(this._ctx.textBaseline=t.oy==0?"top":t.oy==1?"bottom":"middle"),G||(C=-this._ctx.measureText(t.t).width*t.ox),S||(b=-d*t.oy),s&&(t.bz??1)&&this._ctx.strokeText(t.t,C,b),a||(this._ctx.fillStyle="#000"),(!a&&!s||a)&&this._ctx.fillText(t.t,C,b)}this._ctx.restore()}}play(e,r=1,i=0){if(e in this._eng.audios){let n=new Audio;return n.src=this._eng.base+e,n.volume=r,n.currentTime=i,n.addEventListener("ended",()=>n=null),n.play(),!0}return!1}clear(){this._ctx.clearRect(0,0,this.w,this.h)}fit=!1;fitfull(){let{width:e,height:r}=(this.dom.parentElement||this.dom).getBoundingClientRect(),i=this.w/this.h;e/r>i?(this.dom.style.width="auto",this.dom.style.height="100%"):(this.dom.style.width="100%",this.dom.style.height="auto")}tile(e){let r=e.sx!=null?e.sx:e.s!=null?e.s:this.def.sx!=null?this.def.sx:this.def.s!=null?this.def.s:1,i=e.sy!=null?e.sy:e.s!=null?e.s:this.def.sy!=null?this.def.sy:this.def.s!=null?this.def.s:1,n=this.dom.getBoundingClientRect(),t=n.width/this.w,a=n.height/this.h,s=this.w/innerWidth;if(!e.f||!(e.f in this._eng.imgs))e.f!=null&&(this.dom.style.background=e.f);else{if(!this._tile_pic.includes(e.f)){let o=document.createElement("link");o.setAttribute("rel","preload"),o.setAttribute("href",`${this._eng.base}${e.f}`),o.setAttribute("as","image"),document.body.appendChild(o)}this.dom.style.backgroundImage=`url(${this._eng.base}${e.f})`,this.dom.style.backgroundPosition=`calc(50% + ${((e.x||0)-this.x)*this.sx*t}px) calc(50% + ${((e.y||0)-this.y)*this.sy*a}px)`,this.dom.style.backgroundSize=`${this._eng.imgs[e.f].width*this.sx*r/s}px ${this._eng.imgs[e.f].height*this.sy*i/s}px`}}_tile_pic=[];rect(e){let r=e.f!=null&&!(e.f in this._eng.imgs),i=e.crop!=null&&e.crop.length==4,n=e.crop!=null&&e.crop.length>=8;e.ox=e.ox??(!e.o||!e.o.includes("w")&&!e.o.includes("e")?.5:e.o&&e.o.includes("e")?1:0),e.oy=e.oy??(!e.o||!e.o.includes("n")&&!e.o.includes("s")?.5:e.o&&e.o.includes("s")?1:0);let t=e.crop&&i?[e.crop[2],e.crop[3]]:e.crop&&n?[e.crop[4]*(e.crop[6]+1)-(e.crop[8]??0),e.crop[5]*(e.crop[7]+1)-(e.crop[9]??0)]:e.f&&!r?[this._eng.imgs[e.f].width,this._eng.imgs[e.f].height]:[0,0];return[[t[0]*-(e.ox??.5)*(e.sx??e.s??1),t[1]*-(e.oy??.5)*(e.sy??e.s??1)],[],[t[0]*(e.sx??e.s??1),t[1]*(e.sy??e.s??1)],[]]}dom;scene=null;_ctx;_eng;constructor(e="",r,i=640,n=360){this.dom=typeof e!="string"?e:e.length&&document.querySelector(e)?document.querySelector(e):document.createElement("canvas"),this.dom.style.aspectRatio=`${i} / ${n}`,this.w=i,this.h=n,this._ctx=this.dom.getContext("2d"),this._ctx.imageSmoothingEnabled=!1,this._eng=r,r.cameras.push(this),r.inp.bind(this)}},me=class{x=0;_x=0;_gx=0;get dx(){return this.x-this._x}set dx(e){this._x=this.x-e}y=0;_y=0;_gy=0;get dy(){return this.y-this._y}set dy(e){this._y=this.y-e}rx=0;_rx=0;_grx=0;get drx(){return this.rx-this._rx}set drx(e){this._rx=this.rx-e}ry=0;_ry=0;_gry=0;get dry(){return this.ry-this._ry}set dry(e){this._ry=this.ry-e}b=0;_b=0;get db(){return this.b^this._b}set db(e){this._b=this.b^e}cb(e,r=null){return(this.db&e)!=0&&(r==null?(this.b&e)!=0:(this.b&e)==r)}sx=0;_sx=0;get dsx(){return this.sx-this._sx}set dsx(e){this._sx=this.sx-e}sy=0;_sy=0;get dsy(){return this.sy-this._sy}set dsy(e){this._sy=this.sy-e}get gx(){return this.x-this._gx}get gy(){return this.y-this._gy}get grx(){return this.rx-this._grx}get gry(){return this.ry-this._gry}get g(){return Math.hypot(this.gx,this.gy)}get gr(){return Math.hypot(this.grx,this.gry)}click(e=1){return this.g<e&&this.cb(1,0)}over(e,r=[0,0],i){let n=i??(this._cam.def.c!=null?this._cam.def.c:1),t=(this.x-this._cam.w/2*n+this._cam.x*n*this._cam.sx)*Math.pow(this._cam.sx,-n)-r[0],a=(this.y-this._cam.h/2*n+this._cam.y*n*this._cam.sy)*Math.pow(this._cam.sy,-n)-r[1],s=!1;for(let o=0,h=e.length-1;o<e.length;h=o++){let m=e[o].length==2&&e[h].length==2;if(o==0&&e[h].length==0&&h--,o!=0&&o+1<e.length&&e[o].length==0&&e[o-1].length==2&&e[o+1].length==2){let u=e[o-1][0],g=e[o-1][1],y=u+e[o+1][0],k=g+e[o+1][1];g>a!=k>a&&u>t!=y>t&&(s=!s),o++}else if(m){let u=e[o][0],g=e[o][1],y=e[h][0],k=e[h][1];g>a!=k>a&&t<(y-u)*(a-g)/(k-g)+u&&(s=!s)}}return s}in(...e){for(let r of e)if(this.x>r[0]&&this.x<r[0]+r[2]&&this.y>r[1]&&this.y<r[1]+r[3])return!0;return!1}rin(...e){for(let r of e)if(this.rx>r[0]&&this.rx<r[0]+r[2]&&this.ry>r[1]&&this.ry<r[1]+r[3])return!0;return!1}key={};dkey={};handle(e){if(e instanceof WheelEvent)this.sx+=e.deltaX,this.sy+=e.deltaY;else if(e instanceof MouseEvent){let r=this._cam.dom.getBoundingClientRect(),i=this._cam.w/this._cam.h,n=i>r.width/r.height?[r.width,r.width/i]:[r.height*i,r.height];this.x=(e.clientX-r.left-(r.width-n[0])/2)/n[0]*this._cam.w,this.y=(e.clientY-r.top-(r.height-n[1])/2)/n[1]*this._cam.h,this.rx=(this.x-this._cam.w/2+this._cam.x)/this._cam.sx,this.ry=(this.y-this._cam.h/2+this._cam.y)/this._cam.sy,this.b=e.buttons,this.cb(1)&&(this._gx=this.x,this._gy=this.y,this._grx=this.rx,this._gry=this.ry),e.preventDefault()}else e instanceof KeyboardEvent&&(e.type=="keydown"?this.key[e.key.toLowerCase()]=this.dkey[e.key.toLowerCase()]=Number(e.ctrlKey)+(Number(e.shiftKey)<<1)+(Number(e.altKey)<<2):(delete this.key[e.key.toLowerCase()],this.dkey[e.key.toLowerCase()]=-1))}reset(){this.dx=0,this.dy=0,this.db=0,this.dsx=0,this.dsy=0,this.drx=0,this.dry=0,this.dkey={}}constructor(e){this._eng=e}_eng;bind(e){this._cam=e,addEventListener("wheel",r=>this.handle(r)),addEventListener("mousemove",r=>this.handle(r)),addEventListener("mouseover",r=>this.handle(r)),addEventListener("mousedown",r=>this.handle(r)),addEventListener("mouseup",r=>this.handle(r)),addEventListener("mouseenter",r=>this.handle(r)),addEventListener("mouseout",r=>this.handle(r)),addEventListener("keydown",r=>this.handle(r)),addEventListener("keyup",r=>this.handle(r))}_cam},_=class{static res=[];static depend=[];render(e,r,i){return[]}eng=null;scene=null;constructor(...e){}},R=class{entities=[];add(...e){for(let r of e)r.eng=this.eng,this.entities.push(r)}remove(...e){for(let r=0;r<this.entities.length;r++)e.includes(this.entities[r])&&(this.entities.slice(r,1),r--)}show(e){e?e.scene=this:this.eng.cameras.length&&(this.eng.cameras[0].scene=this)}eng;constructor(e,...r){this.eng=e,this.add(...r)}},W=class{imgs={};fonts={};audios={};base="";load(e,...r){let i=[];for(let n of r)i.push(...n.res),n.depend.length&&i.push(...this.load(null,...n.depend));return e!=null&&this.load_res(e,...i),i}load_res(e,...r){let i=[],n=!1,t=(s,o)=>{s==-1&&(this.load_err.push(this.base+r[o]),n=!0),i[o][0]=s,e(n?-1:i.map(h=>h[0]/h[1]).reduce((h,m)=>h+m)/i.length)},a=0;for(let s of r){if(s in this.imgs||s in this.fonts||s in this.audios){i.push([0,1]),t(1,a),a++;continue}let o=s.split(".").reverse()[0].toLowerCase();if(["png","jpg","jpeg"].includes(o)){i.push([0,1]);let h=new Image,m=a;h.onload=()=>t(1,m),h.onerror=()=>t(-1,m),h.src=this.base+s,this.imgs[s]=h}else if(["mp3","wav"].includes(o)){i.push([0,1]),this.audios[s]=new Audio;let h=a,m=this.audios[s];m.active=!1,m.oncanplaythrough=()=>t(1,h),m.onerror=()=>t(-1,h),m.src=this.base+s,m.volume=0,m.addEventListener("ended",()=>{m.currentTime=0,m.play()}),m.load()}else if(["ttf","mp3","wav"].includes(o)){i.push([0,5]);let h=a,m=new XMLHttpRequest;m.open("GET",this.base+s),m.responseType="blob",m.onreadystatechange=()=>{if(t(m.readyState,h),m.readyState==4&&m.status!=200)return t(-1,h);if(!(m.readyState!=4||m.status!=200)){if(o=="ttf"){let u=this.fonts[s]=`font_${Object.keys(this.fonts).length}`,g=document.createElement("h1");g.style.font=`20px ${u}`,g.innerHTML=u,g.style.position="fixed",g.style.left="0",g.style.top="100%";let y=document.createElement("style");y.innerHTML+=`@font-face {font-family:"${u}";src:url("${URL.createObjectURL(m.response)}") format("truetype");}`,document.head.appendChild(y),document.body.appendChild(g);let k=B=>{document.fonts.check(`20px ${u}`)?t(5,h):B>1e3?t(-1,h):setTimeout(k,10,B+1)};k(0)}if(["mp3","wav"].includes(o)){this.audios[s]=new Audio;let u=this.audios[s];u.active=!1,u.src=URL.createObjectURL(m.response),u.volume=0,u.addEventListener("ended",()=>{u.currentTime=0,u.play()}),t(5,h)}else t(5,h)}},m.send()}else i.push([0,1]),this.error_add(new Error(`Unknown file type "${o}"`)),t(-1,a);a++}n||e(0)}errors=[];load_err=[];error_add(e){for(let r of this.errors)if(r.message==e.message)return;this.errors.push(e),console.log(e)}cameras=[];inp;debug={m:[1,0,0,1,0,0],_m:[1,0,0,1,0,0],mp:e=>{if(this.inp.key.a!=null&&(this.debug.m[0]-=e*(this.inp.key.a==0?1:this.inp.key.a&2?.25:0)),this.inp.key.d!=null&&(this.debug.m[0]+=e*(this.inp.key.d==0?1:this.inp.key.d&2?.25:0)),this.inp.key.q!=null&&(this.debug.m[1]-=e*(this.inp.key.q==0?1:this.inp.key.q&2?.25:0)),this.inp.key.e!=null&&(this.debug.m[1]+=e*(this.inp.key.e==0?1:this.inp.key.e&2?.25:0)),this.inp.key.x!=null&&(this.debug.m[2]-=e*(this.inp.key.x==0?1:this.inp.key.x&2?.25:0)),this.inp.key.z!=null&&(this.debug.m[2]+=e*(this.inp.key.z==0?1:this.inp.key.z&2?.25:0)),this.inp.key.s!=null&&(this.debug.m[3]-=e*(this.inp.key.s==0?1:this.inp.key.s&2?.25:0)),this.inp.key.w!=null&&(this.debug.m[3]+=e*(this.inp.key.w==0?1:this.inp.key.w&2?.25:0)),this.inp.key.c!=null&&(this.debug.m[4]-=e*(this.inp.key.c==0?4:this.inp.key.c&2?.25:0)),this.inp.key.v!=null&&(this.debug.m[4]+=e*(this.inp.key.v==0?4:this.inp.key.v&2?.25:0)),this.inp.key.r!=null&&(this.debug.m[5]-=e*(this.inp.key.r==0?4:this.inp.key.r&2?.25:0)),this.inp.key.f!=null&&(this.debug.m[5]+=e*(this.inp.key.f==0?4:this.inp.key.f&2?.25:0)),this.inp.key[1]!=null||this.inp.key[2]!=null){let r=Math.PI/16*e*(this.inp.key[1]!=null?1:-1),i=Math.cos(r),n=Math.sin(r),t=[...this.debug.m];this.debug.m=[t[0]*i+t[2]*n,t[1]*i+t[3]*n,t[2]*i-t[0]*n,t[3]*i-t[1]*n,t[4],t[5]]}if(!Object.keys(this.inp.key).length){for(let r=0;r<6;r++)if(this.debug.m[r]!=this.debug._m[r]){console.log("DEBUG MATRIX:",this.debug.m.toString()),this.debug._m=[...this.debug.m];break}}},v:1,vp:e=>{this.inp.key.a!=null&&(this.debug.v-=e*(this.inp.key.a==0?1:this.inp.key.a&2?.25:0)),this.inp.key.d!=null&&(this.debug.v+=e*(this.inp.key.d==0?1:this.inp.key.d&2?.25:0)),console.log(this.debug.v)}};_wait=0;_times=[];_start;get fps(){return this._times.length}set fps(e){this._wait=e?2e3/e:0}scene=null;start_loop(e=!0){let r=performance.now(),i=this._times.length?r-this._times[this._times.length-1]:0;this._times=this._times.filter(t=>r-t<=1e3),this._times.push(r),e&&(this._start=r);for(let t in this.audios)this.audios[t].active=!1;let n=0;for(let t of this.cameras){t.cursor="default",t.clear(),t.fit&&t.fitfull(),t.tolisten=[];let a=[];if(t.scene!=null)for(let h of t.scene.entities){let m=w(h.render(i/1e3,r-this._start,t));for(let u of m)a.push(u)}let s=0,o=0;for(let h=a.length-1;h>=0;h--){let m=a[h];!m.hover&&!m.press&&!m.click||(m.p==null&&(m.p=t.rect(m)),this.inp.over(m.p,[m.x??0,m.y??0],m.c??1)&&(o==0&&m.hover&&m.hover(m),s==0&&m.click&&this.inp.click()&&(m.click(m),s++),m.press&&this.inp.b&1&&this.inp.g<1&&m.press(m)))}t.render({},...a),t.dom.style.cursor=t.cursor,this.loop(i/1e3,r-this._start,t),n++}for(let t in this.audios){let a=this.audios[t];a.active&&a.paused?a.play():!a.active&&!a.paused&&(a.currentTime=0,a.pause())}this.inp.reset(),setTimeout(()=>this.start_loop(!1),this._wait-i>0?this._wait-i:0)}loop=()=>{};constructor(){this.inp=new me(this),this.start_loop()}};function w(p){if(!p.length)return p;let[e,...r]=p,i=[];for(let n of r)i.push({...e,...n});return i}function he(p,e,r=0,i=0,n=1,t=1,a="p"){let s=(o,h,m)=>{let u=`${r+h}_${i+m}`,g=0;e[u]&&e[u].data&&e[u].data[a]&&(g=e[u].data[a]);let y=structuredClone(p[g|o]);y.f||(y.f="tile/test.png"),y.data={...e[u]?.data||{},...p[g|o]?.data||{}},y.data[a]=g|o,e[u]=y};for(let o=0;o<n;o++)for(let h=0;h<t;h++)s(15,o,h);for(let o=0;o<n;o++)s(3,o,-1);for(let o=0;o<n;o++)s(12,o,t);for(let o=0;o<t;o++)s(5,-1,o);for(let o=0;o<t;o++)s(10,n,o);s(1,-1,-1),s(2,n,-1),s(4,-1,t),s(8,n,t)}var J=class extends _{per=0;start=()=>{};render(e,r,i){return this.eng==null?[]:[{c:0},...this.per!=1?[{p:[[-100,-10],[],[200,20],[]],b:this.per<0?"red":"white",bz:2,x:i.w/2,y:i.h/2},{a:this.per<0?0:1,p:[[-96,-6],[],[192*this.per,12],[]],f:"white",x:i.w/2,y:i.h/2},{t:this.per<0?"Error loading assets":"Loading...",f:this.per<0?"red":"white",x:i.w/2,y:i.h/2-30},{a:this.per<0?.75:0,t:`failed: ${this.eng.load_err[this.eng.load_err.length-1]}`,tz:15,f:"red",x:i.w/2,y:i.h/2+30}]:[{x:i.w/2,y:i.h/2,t:"Click to start game",f:"white"},{p:[[0,0],[],[i.w,i.h],[]],click:n=>this.start()}]]}};var x=class extends _{static key="";item="";focused=!1;own=1;price=0;on_focused=()=>{};popup=[];x;y;name="Building";base(e,r,i,n=1){this._c+=((this.focused?0:1)-this._c)*e*10;let t=this._c;return{c:t,x:this.x*t+.25*i.w*(1-t),y:this.y*t+.6*i.h*(1-t),s:n*t+1*(1-t),click:a=>{this.focused=!0,this.on_focused(this)}}}_c=1;render_pin(e,r,i,n=1){return this.popup.length==0?[]:[{x:this.x,y:this.y-100},{f:"ui/pin.png",s:.25,oy:.4,click:t=>{this.focused=!0,this.on_focused(this)}},...this.popup]}menu(e,r,i,n){return[]}constructor(e,r,i,n){super(),this.eng=e.eng,this.x=r*72+i*64,this.y=i*36-r*19}};var ue=class{money=0;own=[];item=[];saving=0;loan=0;logs=[[],[]];last=0;day=10;update(){performance.now()-this.last<1e3||(this.logs[0].push(this.saving),this.logs[1].push(this.loan),this.last=performance.now(),this.logs[0]=this.logs[0].slice(-100),this.logs[1]=this.logs[1].slice(-100))}loaned(e){if(e<0&&this.money<-e)return z([{t:"Insufficent funds ",f:"#F44336",tz:15}]);if(this.loan>1e5)return z([{t:"Reached Max loaned",f:"#F44336",tz:15}]);this.loan+e>1e5&&(z([{t:"Reached Max loaned",f:"black",tz:15}]),e=1e5-this.loan),this.money+=e,this.loan+=e}saved(e){if(e<0&&this.saving<-e)return z([{t:"Insufficent savings ",f:"#F44336",tz:15}]);if(this.money<e)return z([{t:"Insufficent funds",f:"#F44336",tz:15}]);this.money-=e,this.saving+=e}purchase(e){if(this.money<e.price)return z([{t:"Insufficent funds",f:"#F44336",tz:15}]);this.money-=e.price,e.own=2,this.own.push(e)}},f=new ue;var l=class extends _{name="";quantity=0;price=0;base(e,r,i,n=1){return{c:0}}menu(e,r,i){return[]}render(e,r,i){return[]}};var Q=class extends l{static res=["item/beef.png"];name="Beef";price=400;render(e,r,i){return[this.base(e,r,i),{f:"item/beef.png",s:.125,m:[1,0,0,1,0,-90]}]}};var T=class extends l{static res=["item/carrot.png"];name="Carrot";price=130;render(e,r,i){return[this.base(e,r,i),{f:"item/carrot.png",s:.125,m:[1,0,0,1,0,-70]}]}};var A=class extends l{static res=["item/chicken.png"];name="Chicken";price=185;render(e,r,i){return[this.base(e,r,i),{f:"item/chicken.png",s:.125,m:[1,0,0,1,0,-90]}]}};var v=class extends l{static res=["item/fertilizer.png"];name="Fertilizer";price=32;render(e,r,i){return[this.base(e,r,i),{f:"item/fertilizer.png",s:.125,m:[1,0,0,1,0,-70]}]}};var E=class extends l{static res=["item/fish.png"];name="Fish";price=175;render(e,r,i){return[this.base(e,r,i),{f:"item/fish.png",s:.125,m:[1,0,0,1,0,-70]}]}};var q=class extends l{static res=["item/garlic.png"];name="Garlic";price=250;render(e,r,i){return[this.base(e,r,i),{f:"item/garlic.png",s:.125,m:[1,0,0,1,0,-70]}]}};var H=class extends l{static res=["item/kadyos.png"];name="Kadyos";price=200;render(e,r,i){return[this.base(e,r,i),{f:"item/kadyos.png",s:.125,m:[1,0,0,1,0,-90]}]}};var V=class extends l{static res=["item/langka.png"];name="Langka";price=100;render(e,r,i){return[this.base(e,r,i),{f:"item/langka.png",s:.125,m:[1,0,0,1,0,-90]}]}};var O=class extends l{static res=["item/pork.png"];name="Pork";price=350;render(e,r,i){return[this.base(e,r,i),{f:"item/pork.png",s:.125,m:[1,0,0,1,0,-90]}]}};var D=class extends l{static res=["item/radish.png"];name="Radish";price=50;render(e,r,i){return[this.base(e,r,i),{f:"item/radish.png",s:.125,m:[1,0,0,1,0,-90]}]}};var Z=class extends l{static res=["item/soup.png"];name="Soup";price=35;render(e,r,i){return[this.base(e,r,i),{f:"item/soup.png",s:.15,m:[1,0,0,1,0,-60]}]}};var I=class extends l{static res=["item/tomato.png"];name="Tomato";price=80;render(e,r,i){return[this.base(e,r,i),{f:"item/tomato.png",s:.125,m:[1,0,0,1,0,-90]}]}};var U=class extends l{static res=["item/tuna.png"];name="Tuna";price=270;render(e,r,i){return[this.base(e,r,i),{f:"item/tuna.png",s:.15,m:[1,0,0,1,0,-60]}]}};var X=class extends l{static res=["item/worm.png"];name="Worm";price=650;render(e,r,i){return[this.base(e,r,i),{f:"item/worm.png",s:.125,m:[1,0,0,1,0,-90]}]}};var $=[E,Q,T,A,v,q,H,V,O,D,Z,I,U,X],ce=[{type:"farm",in:[v],out:[T],amount:[1,20],dur:2},{type:"farm",in:[v],out:[q],amount:[1,10],dur:1},{type:"farm",in:[v],out:[H],amount:[1,12],dur:2},{type:"farm",in:[v],out:[I],amount:[1,10],dur:1},{type:"farm",in:[v],out:[D],amount:[1,10],dur:1},{type:"farm",in:[T,I],out:[O],amount:[20,30,50],dur:3},{type:"farm",in:[I,E],out:[A],amount:[10,5,40],dur:3},{type:"fish",in:[X],out:[E],amount:[1,50],dur:1},{type:"factory",in:[E],out:[U],amount:[1,2],dur:0}];var ee=class extends _{name="";msg=[];get chat_txt(){return this.msg.length?this.msg[0][0]:""}get chat_num(){return this.msg.length?this.msg[0][1]:0}next(){this.msg.shift()}menu(e,r,i){return[]}render(e,r,i){return[]}};var j=class extends ee{static res=["people/mentor_body.png","people/mentor_head.png"];name="Mentor";render(e,r,i){let n=this.chat_num&3,t=this.chat_num>>2&3;return[{c:0},{f:"people/mentor_body.png",s:.25,crop:[900*(n%2),900*Math.floor(n/2),900,900],y:Math.sin(r/150+Math.PI/2)},{f:"people/mentor_head.png",s:.25,crop:[900*(t%2),900*Math.floor(t/2),900,900],y:-60+Math.sin(r/150)}]}};var ge=[j];function c(p,e,r=1,i=1,n=0){let t=[];"t"in p&&(t.push({t:p.t,tz:p.tz??20,b:"black",bz:p.bz??4,x:p.x??0,y:(p.y??0)+3,f:p.f??"white"}),delete p.t,delete p.tz,delete p.f,delete p.bz),"f"in p&&(t.push({f:p.f,x:(p.x??0)+(p.data?.x??0),y:(p.y??0)+(p.data?.y??0),s:.25,o:p.o??"",r:p.r??0,a:(n&3)==3?.5:1}),delete p.f,delete p.r);let a=p.click;return"click"in p&&delete p.click,p.click=s=>{s.data&&s.data.disabled||(s.data?.button&&e.play("sfx/button.mp3",.25),a&&a(s))},[{f:(n&3)==3?"ui/button_disabled.png":(n&3)==2?"ui/button_down.png":"ui/button_up.png",s:.25,crop:(n&4)==4?[49,48,49,48,46,45,r,i,11,11]:[60,59,60,59,57,56,r,i],press:s=>{s.data&&s.data.button&&(s.f="ui/button_down.png")},...p,data:{...p.data??{},button:(n&3)==0,disabled:(n&3)==3}},...t]}var Y=class p extends _{static res=["coins.png","ui/title.png","ui/resume.png","ui/options.png","ui/exit.png","ui/close.png","ui/menu.png","ui/bag.png","ui/next.png","font/emulogic.ttf","music/bgm1_prototype.wav","sfx/button.mp3","sfx/whoosh.mp3","ui/button_up.png","ui/button_down.png","ui/button_disabled.png","plan.png"];static depend=[...$,...ge];pop=[];pop_c=0;pop_t=0;help=0;help_c=0;chat=null;closed=()=>{};popup(e){this.pop=e,this.pop_t=0}focused=()=>{};tutorial=1;menu=0;m=0;focus=null;title="Inventory";sprites=[];render(e,r,i){if(this.eng==null)return[];if(this.pop_c+=((this.pop.length?1:0)-this.pop_c)*e*10,this.pop.length&&this.pop_t==0){this.pop_t=performance.now();for(let s of this.pop)s.c=s.c??0}this.pop.length&&performance.now()-this.pop_t>3e3&&(this.pop=[]),this.help_c+=(this.help-this.help_c)*e*10,this.eng.inp.dkey.q==0&&(this.help=1-this.help),this.m+=(this.menu-this.m)*e*10,this.menu!=2&&this.focus!=null&&Math.abs(this.m-2)>.99&&(this.focus=null),this.chat&&!this.chat.msg.length&&(this.chat=null);let n=(...s)=>s.map(o=>Math.max(0,1-Math.abs(this.m-o))).reduce((o,h)=>o+h,0),t=Math.floor(r/200)%4,a=(s,o=1,h=1,m=0)=>c(s,i,o,h,m);return[{c:0,hover:s=>{s.click&&(s.cur="pointer")},tf:"font/emulogic.ttf"},{f:"music/bgm1_prototype.wav"},{f:"black",p:[[0,0],[],[i.w,i.h]],a:.5*n(0,2),click:this.menu==1?void 0:()=>{}},...this.focus==null?[]:w(this.focus.render(e,r,i)),{x:i.w*.5,y:i.h*.25*(2*n(0)-1),f:p.res[1],s:.35},{f:"coins.png",x:(i.w*.72+25)*n(0)-50*n(0)+25,y:(i.h*.2+25)*n(0)-50*n(0)+25,crop:[Math.abs(2-t)*22,0,22,23],sx:t==1?-1.5:1.5,sy:1.5},{t:String(f.money),tz:20,x:44,y:28-38*n(0),o:"w",f:"gold",b:"black",bz:4},{t:`${f.day} days left`,tz:15,x:i.w-130,y:28-38*n(0,2),o:"e",f:"white",b:"black",bz:5},{t:String(this.eng.fps),o:"nw",tz:8},...a({x:i.w/2,y:i.h-200*n(0)+50,t:"resume",f:"#4CAF50",click:s=>this.menu=1},10,2),...a({x:i.w/2,y:i.h-200*n(0)+105,t:"options",f:"#2196F3"},10,2),...a({x:i.w/2,y:i.h-200*n(0)+160,t:"exit",f:"#F44336"},10,2),...a({x:i.w+30-40*n(1),y:10,o:"ne",f:"ui/menu.png",click:s=>this.menu=0,data:{x:-3,y:9}}),...a({x:i.w+30-80*n(1),y:10,o:"ne",f:"ui/bag.png",click:s=>{this.title="Inventory",this.menu=2},data:{x:-7,y:7}}),...a({x:i.w+30-120*n(1),y:10,o:"ne",f:"ui/next.png",click:s=>{},data:{x:-10,y:9}}),...a({x:i.w+70-80*n(2),y:10,o:"ne",f:"ui/close.png",click:s=>{this.closed(),this.focus&&(this.focus.focused=!1),this.menu=1},data:{x:-4,y:6}}),...this.focus==null||this.title.toLowerCase()=="inventory"?[...a({x:i.w/2,y:i.h+150-(i.h/2+135)*n(2)},40,20,1),...Array(32).fill(0).map((s,o)=>{let h=o%8,m=Math.floor(o/8);return{c:0,f:"ui/button_down.png",s:.25,crop:[60,59,60,59,57,56,3,3],x:75+70*h,y:90+70*m+(i.h-50)*(1-n(2))}}),...f.own.map((s,o)=>{let h=o%8,m=Math.floor(o/8);return[...w(s.render(e,r,i)).map(u=>(u.c=0,u.x=75+70*h,u.y=100+70*m+(i.h-50)*(1-n(2)),u.s=.25,u.click=void 0,u)),{c:0,x:75+70*h,y:90+70*m+(i.h-50)*(1-n(2)),p:[[-28,-28],[],[58,57],[]],click:u=>{i.x=s.x,i.y=s.y,this.menu=1}}]}).flat(),...f.item.map((s,o)=>{let h=(o+f.own.length)%8,m=Math.floor((o+f.own.length)/8);return w(s.render(e,r,i)).map(u=>(u.x=75+70*h,u.y=100+70*m+(i.h-50)*(1-n(2)),u))}).flat()]:[...a({x:i.w+150-(i.w/2+5)*n(2),y:i.h/2+15},20,19,1),...a({x:i.w/4,y:i.h+25-(i.h/8+25)*n(2),...[{t:"Cant Own",f:"#F44336"},{t:"Purchase",f:"#4CAF50",click:s=>{this.focus instanceof x&&f.purchase(this.focus)}},{t:"Sell",f:"#2196F3"}][this.focus.own]??{t:"Unknown",f:"#F44336"}},15,2),...this.focus.price&&this.focus.own==1?[{t:`\u20B1${this.focus.price}`,x:i.w/4,y:i.h+25-(i.h/4+15)*n(2),f:"white",a:.75}]:[],...this.focus.menu(e,r,i,n(2)).map(s=>(s.c=s.c??0,s.x=(s.x??0)+i.w+150-(i.w/2+5)*n(2),s.y=(s.y??0)+i.h/2+15,s))],...this.chat!=null?[...w(this.chat.render(e,r,i)).map(s=>(s.x=(s.x??0)+13*i.w/16,s.y=(s.y??0)+9*i.h/16+500*(1-n(1)),s)),...a({x:i.w/2,y:i.h-45+500*(1-n(1)),click:s=>this.chat?.next()},40,6),{t:this.chat.name,x:35,y:i.h-85+500*(1-n(1)),o:"nw"},...this.chat.chat_txt.split(`
`).map((s,o)=>({t:s,x:35,y:i.h-50+500*(1-n(1))+20*o,o:"nw",tz:15,a:.75}))]:[],...this.title.toLowerCase()=="inventory"?[{t:this.title,tz:20,b:"black",bz:4,x:i.w/2,y:28*n(2)-10*(1-n(2)),f:"skyblue"}]:[{t:this.title,tz:15,b:"black",bz:4,x:i.w/4,y:70*n(2)-10*(1-n(2)),f:"skyblue"}],...a({x:i.w/2,y:50*this.pop_c-30,click:s=>this.pop=[]},22,3),...this.pop.map(s=>(s.x=i.w/2,s.y=50*this.pop_c-25,s)),{f:"plan.png",o:"nw",s:.5,y:i.h*(1-this.help_c)}]}};var te=class extends x{static res=["building/bank.png"];static key="bank";item="building/bank.png";own=0;name="DBO Bank";act_loan_pay=!1;act_save_out=!1;render(e,r,i){return[this.base(e,r,i),{f:"building/bank.png",p:[[-62,-100],[],[133,130],[]],m:[1,0,0,1,4,-32]}]}menu(e,r,i){let n=f.logs[0],t=f.logs[1],a=Math.max(100,Math.max(...n,...t));return[...c({x:0,y:-98},i,19,4,2),{p:n.length<2?[[0,55],[270,55]]:n.map((s,o)=>[270*o/(n.length-1),55*(1-s/a)]),b:"green",x:-135,y:-125,bz:2,a:.5},{p:t.length<2?[[0,55],[270,55]]:t.map((s,o)=>[270*o/(t.length-1),55*(1-s/a)]),b:"red",x:-135,y:-125,bz:2,a:.5},{t:"Savings (5% rate)",o:"w",x:-140,y:-30,f:"black",tz:10,a:.75},{t:String(f.saving),o:"w",x:-140,y:-10,f:"black",tz:15},...c({x:-100,y:15,t:"1,000",tz:15,f:"black",bz:0,click:s=>f.saved(1e3*(this.act_save_out?-1:1))},i,5,1),...c({x:0,y:15,t:"10,000",tz:15,f:"black",bz:0,click:s=>f.saved(1e4*(this.act_save_out?-1:1))},i,6,1),...c({x:100,y:15,t:"100k",tz:15,f:"black",bz:0,click:s=>f.saved(1e5*(this.act_save_out?-1:1))},i,5,1),...c({x:90,y:-20,t:this.act_save_out?"deposit":"withdraw",tz:10,f:"black",bz:0,click:s=>this.act_save_out=!this.act_save_out},i,6,1),{t:"Loans (8% rate)",o:"w",x:-140,y:70,f:"black",tz:10,a:.75},{t:String(f.loan),o:"w",x:-140,y:90,f:"black",tz:15},...c({x:-100,y:115,t:"1,000",tz:15,f:"black",bz:0,click:s=>f.loaned(1e3*(this.act_loan_pay?-1:1))},i,5,1),...c({x:0,y:115,t:"10,000",tz:15,f:"black",bz:0,click:s=>f.loaned(1e4*(this.act_loan_pay?-1:1))},i,6,1),...c({x:100,y:115,t:"100k",tz:15,f:"black",bz:0,click:s=>f.loaned(1e5*(this.act_loan_pay?-1:1))},i,5,1),...c({x:90,y:80,t:this.act_loan_pay?"take loan":"pay back",tz:10,f:"black",bz:0,click:s=>this.act_loan_pay=!this.act_loan_pay},i,6,1)]}};var ie=class extends x{static res=["building/blank_mask.png"];static key="blank";item="building/blank_mask.png";own=0;name="Private building";color=["white","white","white"];render(e,r,i){let n=this.base(e,r,i);return[{x:n.x??0,y:n.y??0,c:n.c??1},{p:[[-45,-33],[0,-7],[50,-20],[50,11],[0,24],[-38,2],[-45,0],[]],f:this.color[0]},{p:[[-45,-65],[0,-39],[50,-52],[50,-20],[0,-7],[-45,-33],[]],f:this.color[1]},{p:[[-49,-69.5],[8,-85],[54,-58],[54,-54],[53,-53],[53,-50],[0,-36],[-47,-64],[-47,-65],[-49,-67],[]],f:this.color[2]},{f:"building/blank_mask.png",p:[[-48,-85],[],[102,110],[]],m:[1,0,0,1,0,-30],...n}]}constructor(e,r,i,n){super(e,r,i,n),n.color?.length==3&&(this.color=n.color)}};var re=class extends x{static res=["building/callereal.png","ui/triangle.png"];static key="callereal";static depend=$;item="building/callereal.png";own=0;name="Calle Real";items=[];page=0;constructor(e,r,i,n){super(e,r,i,n);for(let t of $)this.items.push(new t)}render(e,r,i){return[this.base(e,r,i),{f:"building/callereal.png",p:[[-85,-140],[],[185,160],[]],m:[1,0,0,1,0,-60]}]}menu(e,r,i,n){return[...c({x:0,y:-98},i,19,4,2),...this.items.slice(4*this.page,4*(this.page+1)).map((t,a)=>[...c({x:0,y:-36+48*a},i,19,2),...w(t.render(e,r,i)).map(s=>(s.x=-120,s.y=-26+48*a,s)),{t:t.name,x:-100,y:-46+48*a,o:"nw",tz:15}]).flat(),...c({x:-170+40*(1-n),y:50,f:"ui/triangle.png",r:-Math.PI/2,click:t=>{this.page--}},i,1,1,this.page>0?0:3),...c({x:-170+40*(1-n),y:80,f:"ui/triangle.png",r:Math.PI/2,click:t=>{this.page++}},i,1,1,this.page*4+4<this.items.length?0:3)]}};var ne=class extends x{static res=["building/factory.png"];static key="factory";item="building/factory.png";name="Factory";render(e,r,i){return[this.base(e,r,i),{f:"building/factory.png",p:[[-75,-125],[],[165,145],[]],m:[1,0,0,1,0,-50]}]}};var se=class extends x{static res=["building/farm.png","ui/arrow.png","ui/arrow_off.png"];static key="farm";item="building/farm.png";name="Farm";price=5e4;render(e,r,i){return[this.base(e,r,i),{f:"building/farm.png",p:[[-64,-49],[],[120,97],[]],m:[1,0,0,1,0,-10]}]}page=0;processes=ce.reduce((e,r,i)=>(r.type=="farm"&&e.push({id:i,in:r.in.map(n=>new n),out:r.out.map(n=>new n),amount:r.amount,dur:r.dur}),e),[]);menu(e,r,i,n){let t=f.own.includes(this);return[...t?this.processes.slice(this.page*5,5*(this.page+1)).map((a,s)=>[...c({x:0,y:-82+48*s},i,19,2,1),...c({x:132,y:-92+48*s,f:"ui/triangle.png",r:-Math.PI/2},i,.75,.75,4),...c({x:132,y:-72+48*s,f:"ui/triangle.png",r:Math.PI/2},i,.75,.75,4),...a.in.map((o,h)=>[...w(o.render(e,r,i)).map(m=>(m.x=-120+35*h,m.y=-73+48*s,m)),{t:String(a.amount[h]),x:-120+35*h,y:-70+48*s,b:"#FBE7CD",bz:2,f:"black",tz:10}]).flat(),...a.out.map((o,h)=>[...w(o.render(e,r,i)).map(m=>(m.x=70+35*h,m.y=-73+48*s,m)),{t:String(a.amount[a.in.length+h]),x:-120+35*h,y:-70+48*s,b:"#FBE7CD",bz:2,f:"black",tz:10}]).flat(),{f:"ui/arrow_off.png",s:.125,y:-72+48*s},{t:`${a.dur} days`,y:-85+48*s,tz:10}]).flat():[{t:"You dont own this",tz:15,a:.5}],...c({x:-170+40*(1-n),y:50,f:"ui/triangle.png",r:-Math.PI/2,click:a=>{this.page--}},i,1,1,this.page<=0||!t?3:0),...c({x:-170+40*(1-n),y:80,f:"ui/triangle.png",r:Math.PI/2,click:a=>{this.page++}},i,1,1,this.page*5+5>=this.processes.length||!t?3:0)]}};var oe=class extends x{static res=["building/fishing.png"];static key="fishing";item="building/fishing.png";name="Fishing Area";price=5e4;render(e,r,i){return[this.base(e,r,i,.75),{f:"building/fishing.png",m:[1,0,0,1,5,-35],p:[[-70,-80],[],[145,110],[]]}]}};var be=[te,ie,re,ne,se,oe];var K=class p extends _{static res=["tile/grass_0.png","tile/sand_0.png","tile/sand1.png","tile/water_0.png","tile/water_1.png","tile/ws_x_0.png","tile/ws_y_0.png","tile/ws_xy_0.png","tile/ws__0.png","tile/ws_x_1.png","tile/ws_y_1.png","tile/ws_xy_1.png","tile/ws__1.png","tile/sg_x_0.png","tile/sg_y_0.png","tile/sg_xy_0.png","tile/sg__0.png","tile/test.png","road/dirt.png","road/dirt_empty.png","road/cement.png","road/cement_empty.png","prop/tree.png","prop/bush.png","prop/coconut.png","tile/water_bg_0.png","tile/water_bg_1.png","ui/pin.png"];static depend=be;ly=[{},{}];focused=()=>{};generate(e=[]){this.ly=[{},{}];let[r,i]=this.ly;for(let n of e){let t=!0,a=`${n.x}_${n.y}`;if(n.w==null&&(n.w=1),n.h==null&&(n.h=1),n.type=="sand")he([{},{data:{pre:"ws_xy"},m:[.312,.463,-2.45,-.23,-1,1]},{data:{pre:"ws_xy"},m:[-1,0,0,-1,-1,1]},{data:{pre:"ws_y"},m:[-1,0,0,-1,-1,1]},{data:{pre:"ws_xy"}},{data:{pre:"ws_x"}},{},{data:{pre:"ws_"},m:[-.2404,-.45704,2.5288,.2536,0,0]},{data:{pre:"ws_xy"},m:[-.355,.37,2.31,.38,-1,1]},{},{data:{pre:"ws_x"},m:[-1,0,0,-1,-1,1]},{data:{pre:"ws_"},m:[1,0,0,1,-2,0]},{data:{pre:"ws_y"}},{data:{pre:"ws_"},m:[.95175,.235,.275,-.951,0,.6285]},{data:{pre:"ws_"},m:[.26139,.4746,-2.4687,-.27096,4.952,2.076]},{data:{pre:"sand"}}],r,n.x,n.y,n.w,n.h);else if(n.type=="grass")he([{},{data:{top:"sg_xy"},m:[.312,.463,-2.45,-.23,-1,1]},{data:{top:"sg_xy"},m:[-1,0,0,-1,-1,1]},{data:{top:"sg_y"},m:[-1,0,0,-1,-1,1]},{data:{top:"sg_xy"}},{data:{top:"sg_x"}},{},{data:{top:"sg_"},m:[-.2404,-.45704,2.5288,.2536,0,0]},{data:{top:"sg_xy"},m:[-.355,.37,2.31,.38,-1,1]},{},{data:{top:"sg_x"},m:[-1,0,0,-1,-1,1]},{data:{top:"sg_"},m:[1,0,0,1,-2,0]},{data:{top:"sg_y"}},{data:{top:"sg_"},m:[.95175,.235,.275,-.951,0,.6285]},{data:{top:"sg_"},m:[.26139,.4746,-2.4687,-.27096,4.952,2.076]},{data:{top:"grass"}}],r,n.x,n.y,n.w,n.h,"pt");else if(n.type=="dirt")for(let s=0;s<n.w;s++){let o=`${n.v?n.x:n.x+s}_${n.v?n.y+s:n.y}`;o in i?i[o]={f:"road/dirt_empty.png",m:[1.33725,-.071745,-.24675,1.2205,0,0]}:o in r&&(i[o]={f:"road/dirt.png",m:n.v?[1.33725,-.071745,-.24675,1.2205,0,0]:[-1.27025,-.39275,0,1.2135,0,0]})}else if(n.type=="cement")for(let s=0;s<n.w;s++){let o=`${n.v?n.x:n.x+s}_${n.v?n.y+s:n.y}`;o in i?i[o]={f:"road/cement_empty.png",m:[1.33725,-.071745,-.24675,1.2205,0,0]}:o in r&&(i[o]={f:"road/cement.png",m:n.v?[1.33725,-.071745,-.24675,1.2205,0,0]:[-1.27025,-.39275,0,1.2135,0,0]})}else if(n.type=="tree")i[a]={f:"prop/tree.png",m:[1,0,0,1,0,-25]};else if(n.type=="forest"){n.d==null&&(n.d=1);for(let s=0;s<n.h*n.d;s++)for(let o=0;o<n.w*n.d;o++){let h=[n.x+o/n.d+(Math.random()-.5)/2,n.y+s/n.d+(Math.random()-.5)/4],m=`${Math.round(h[0])}_${Math.round(h[1])}`;i[`${h[0]}_${h[1]}`]=m in r&&r[m].data?.top=="grass"?{f:"prop/tree.png",m:[1,0,0,1,0,-25]}:{f:"prop/coconut.png",s:.0625,m:[1,0,0,1,0,-350]}}}else n.type=="bush"?i[a]={f:"prop/bush.png",s:1}:n.type=="test"?i[a]={f:"tile/test.png",a:.5}:t=!1;if(!t){for(let s of p.depend)if(n.type==s.key){let o=new s(this,n.x,n.y,n);o.on_focused=h=>this.focused(h),i[a]={data:{build:o}},t=!0}}t||this.eng?.error_add(new Error(`Unknown type "${n.type}`))}for(let n in this.ly)for(let t in this.ly[n]){let a=t.split("_").map(o=>Number(o)),s=this.ly[n][t];Object.assign(s,{x:a[0]*72+a[1]*64,y:a[1]*36-a[0]*19}),n=="0"&&s.data?.pre&&(s.f=`tile/${s.data.top||s.data.pre}_0.png`)}}init=!0;render(e,r,i){i.tile({f:i.sx<.3?"#72C1E0":`tile/water_bg_${Math.floor(r/800)%2}.png`,s:.5});for(let n in this.ly[0]){let t=this.ly[0][n];t.data&&t.data.pre&&t.data.pre[0]=="w"&&!t.data.top&&(t.f=`tile/${t.data.pre}_${Math.floor(r/800)%2}.png`)}return[{hover:n=>{n.click&&(n.cur="pointer")}},...Object.values(this.ly[0]),...Object.values(this.ly[1]).map(n=>{if(n.data?.build){let t=n.data.build;return[...w(t.render(e,r,i)),...w(t.render_pin(e,r,i))]}return[n]}).reduce((n,t)=>[...n,...t],[])]}};var ye=[{type:"sand",x:-10,y:-10,w:20,h:20},{type:"grass",x:-9,y:-5,w:18,h:14},{type:"fishing",x:7,y:9},{type:"dirt",x:3,y:-8,w:16,v:!0},{type:"cement",x:-8,y:1,w:16},{type:"bank",x:2,y:0},{type:"tree",x:1.3,y:.3},{type:"callereal",x:0,y:0},{type:"factory",x:-5,y:0},{type:"blank",x:5,y:0,color:["blue","brown","violet"]},{type:"blank",x:4,y:0,color:["red","yellow","green"]},{type:"bush",x:-2,y:0},{type:"farm",x:-2,y:0},{type:"tree",x:0,y:3},{type:"bush",x:-5,y:5},{type:"forest",x:-8,y:-8,w:5,h:5}];var M=new W,ae=new N("#game",M);M.base="/assets/";ae.fit=!0;ae.scale(4);for(let p of $)f.item.push(new p);var le=new J,_e=new R(M,le);M.load(p=>{le.per=p,p==1&&xe.show()},Y,K);_e.show();le.start=()=>{ae.full(),xe.show()};var de=new K(M),L=new Y,xe=new R(M,de,L);de.generate(ye);de.focused=p=>{ae.play("sfx/whoosh.mp3",.25,.4),L.title=p.name,L.menu=2,L.focus=p};function z(p){return L.popup(p)}L.menu=1;var we=new j;we.msg=[[`Good morning my new apprentice and
welcome to Iloilo!`,0],[`You must take advantage of the
upcoming Dinagyang festival in ${f.day} days`,5]];M.loop=(p,e,r)=>{let i=M.inp;if(f.update(),L.menu==1){if(i.dsy){let n=Math.max(.25,Math.min(8,r.sx*Math.pow(1.5,-i.dsy/100)));r.s=n}if(i.cb(1)&&i.dx&&i.dy,i.b&1){r.x-=i.dx/r.sx,r.y-=i.dy/r.sy;let n=1300*Math.min(1,r.sx),t=600*Math.min(1,r.sy);r.x=Math.min(n,Math.max(-n,r.x)),r.y=Math.min(t,Math.max(-t,r.y))}}};})();</script></body></html>