<!DOCTYPE html><html><head><title>Noble City</title><style>html,body{background-color:#111;width:100%;height:100%;margin:0;padding:0;overflow:hidden;display:flex;justify-content:center;align-items:center;}canvas{display:block;image-rendering:pixelated;object-fit:contain;box-shadow:0 0 30px #000}</style></head><body><canvas id="game"></canvas><script>(()=>{var q=class{x=0;y=0;sm=1;get w(){return Math.floor(this.dom.width/this.sm)}set w(e){this.dom.width=e}get h(){return Math.floor(this.dom.height/this.sm)}set h(e){this.dom.height=e}set s(e){this.sx=e,this.sy=e}sx=1;sy=1;scale(e){this.dom.width*=e,this.dom.height*=e,this._ctx=this.dom.getContext("2d"),this._ctx.imageSmoothingEnabled=!1,this._ctx.scale(e,e),this.sm*=e}full(){document.body.requestFullscreen()}def={bz:1};cursor="default";tolisten=[];render(e={},...r){let i=this._eng;r.length||(r=[e],e={});for(let s of r){this._ctx.save();let t={};if(Object.assign(t,this.def,e,s),(t.click||t.hover||t.press)&&t.p!=null&&this.tolisten.push(t),t.f&&t.f in i.audios){i.audios[t.f].active=!0,i.audios[t.f].volume=t.a??1;continue}let p=t.f!=null&&!(t.f in i.imgs),n=t.b!=null&&!(t.b in i.imgs),o=t.crop!=null&&t.crop.length==4,h=t.crop!=null&&t.crop.length==8;if(p&&(this._ctx.fillStyle=t.f),n&&(this._ctx.strokeStyle=t.b),this._ctx.lineCap=t.be=="arc"?"round":t.be=="sqr"?"square":"butt",this._ctx.lineJoin=t.bj=="arc"?"round":t.bj=="sqr"?"bevel":"miter",this._ctx.lineWidth=t.bz??1,t.a==0){this._ctx.restore();continue}this._ctx.globalAlpha=t.a??1,t.c=t.c??1;let[m,u]=[Math.pow(this.sx,t.c),Math.pow(this.sy,t.c)];t.sx=(t.sx??t.s??1)*m,t.sy=(t.sy??t.s??1)*u;let[c,b]=t.r?[Math.sin(t.r),Math.cos(t.r)]:[0,1],[v,$]=[this.w/2*t.c*Math.pow(this.sx,t.c-1)+this.x*(1-t.c-m)+(t.x??0)*m,this.h/2*t.c*Math.pow(this.sy,t.c-1)+this.y*(1-t.c-u)+(t.y??0)*u],ie=this.rect(t);if(this._ctx.transform(t.sx*b,t.sx*c,-t.sy*c,t.sy*b,v,$),t.m&&t.m.length==6?this._ctx.transform.apply(this._ctx,t.m):t.m&&i.error_add(new Error(`Invalid transform [${t.m.toString()}]`)),this._ctx.translate(ie[0][0]/t.sx,ie[0][1]/t.sy),t.f&&!p){let l=t.crop&&o?[t.crop[2],t.crop[3]]:t.crop&&h?[t.crop[4]*(t.crop[6]+1),t.crop[5]*(t.crop[7]+1)]:[this._eng.imgs[t.f].width,this._eng.imgs[t.f].height];if(l=[Math.abs(l[0]*t.sx*b),Math.abs(l[1]*t.sy*b)],this.w+l[0]<v||this.h+l[1]<$||v+l[0]<0||$+l[1]<0){this._ctx.restore();continue}}if(t.f!=null&&t.f in i.imgs){if(t.crop&&o)this._ctx.drawImage(i.imgs[t.f],t.crop[0],t.crop[1],t.crop[2],t.crop[3],0,0,t.crop[2],t.crop[3]);else if(t.crop&&h)for(let l=0;l<=t.crop[6];l++)for(let _=0;_<=t.crop[7];_++)this._ctx.drawImage(i.imgs[t.f],t.crop[0]*(l==0?0:l==t.crop[6]?1:.5),t.crop[1]*(_==0?0:_==t.crop[7]?1:.5),t.crop[2],t.crop[3],t.crop[4]*l,t.crop[5]*_,t.crop[2],t.crop[3]);else this._ctx.drawImage(i.imgs[t.f],0,0);t.p=t.p??ie}if(t.p){let l=0,_=0;this._ctx.beginPath();for(let y of t.p)y.length==2&&!l?this._ctx.moveTo(y[0],y[1]):y.length==2&&_==1?(this._ctx.lineTo(t.p[l-2][0]+y[0],t.p[l-2][1]),this._ctx.lineTo(t.p[l-2][0]+y[0],t.p[l-2][1]+y[1]),this._ctx.lineTo(t.p[l-2][0],t.p[l-2][1]+y[1])):y.length==2?this._ctx.lineTo(y[0],y[1]):y.length==0&&l>0&&t.p[l-1].length==2&&l+1!=t.p.length&&t.p[l+1].length==2?_=1:y.length==0&&l+1==t.p.length&&this._ctx.closePath(),l++;n&&this._ctx.stroke(),p&&(t.bz??1)&&this._ctx.fill()}if(t.t){let l=t.tz??20,[_,y]=[0,0],[pe,me]=[!1,!1];this._ctx.font=`${l}px ${t.tf&&t.tf in i.fonts?i.fonts[t.tf]:t.tf??"Arial"}`,(pe=[0,.5,1].includes(t.ox))&&(this._ctx.textAlign=t.ox==0?"start":t.ox==1?"end":"center"),(me=[0,.5,1].includes(t.oy))&&(this._ctx.textBaseline=t.oy==0?"top":t.oy==1?"bottom":"middle"),pe||(_=-this._ctx.measureText(t.t).width*t.ox),me||(y=-l*t.oy),n&&(t.bz??1)&&this._ctx.strokeText(t.t,_,y),p||(this._ctx.fillStyle="#000"),(!p&&!n||p)&&this._ctx.fillText(t.t,_,y)}this._ctx.restore()}}play(e,r=1,i=0){if(e in this._eng.audios){let s=new Audio;return s.src=this._eng.base+e,s.volume=r,s.currentTime=i,s.addEventListener("ended",()=>s=null),s.play(),!0}return!1}clear(){this._ctx.clearRect(0,0,this.w,this.h)}fit=!1;fitfull(){let{width:e,height:r}=(this.dom.parentElement||this.dom).getBoundingClientRect(),i=this.w/this.h;e/r>i?(this.dom.style.width="auto",this.dom.style.height="100%"):(this.dom.style.width="100%",this.dom.style.height="auto")}tile(e){let r=e.sx!=null?e.sx:e.s!=null?e.s:this.def.sx!=null?this.def.sx:this.def.s!=null?this.def.s:1,i=e.sy!=null?e.sy:e.s!=null?e.s:this.def.sy!=null?this.def.sy:this.def.s!=null?this.def.s:1,s=this.dom.getBoundingClientRect(),t=s.width/this.w,p=s.height/this.h,n=this.w/innerWidth;if(!e.f||!(e.f in this._eng.imgs))e.f!=null&&(this.dom.style.background=e.f);else{if(!this._tile_pic.includes(e.f)){let o=document.createElement("link");o.setAttribute("rel","preload"),o.setAttribute("href",`${this._eng.base}${e.f}`),o.setAttribute("as","image"),document.body.appendChild(o)}this.dom.style.backgroundImage=`url(${this._eng.base}${e.f})`,this.dom.style.backgroundPosition=`calc(50% + ${((e.x||0)-this.x)*this.sx*t}px) calc(50% + ${((e.y||0)-this.y)*this.sy*p}px)`,this.dom.style.backgroundSize=`${this._eng.imgs[e.f].width*this.sx*r/n}px ${this._eng.imgs[e.f].height*this.sy*i/n}px`}}_tile_pic=[];rect(e){let r=e.f!=null&&!(e.f in this._eng.imgs),i=e.crop!=null&&e.crop.length==4,s=e.crop!=null&&e.crop.length==8;e.ox=e.ox??(!e.o||!e.o.includes("w")&&!e.o.includes("e")?.5:e.o&&e.o.includes("e")?1:0),e.oy=e.oy??(!e.o||!e.o.includes("n")&&!e.o.includes("s")?.5:e.o&&e.o.includes("s")?1:0);let t=e.crop&&i?[e.crop[2],e.crop[3]]:e.crop&&s?[e.crop[4]*(e.crop[6]+1),e.crop[5]*(e.crop[7]+1)]:e.f&&!r?[this._eng.imgs[e.f].width,this._eng.imgs[e.f].height]:[0,0];return[[t[0]*-(e.ox??.5)*(e.sx??e.s??1),t[1]*-(e.oy??.5)*(e.sy??e.s??1)],[],[t[0]*(e.sx??e.s??1),t[1]*(e.sy??e.s??1)],[]]}dom;scene=null;_ctx;_eng;constructor(e="",r,i=640,s=360){this.dom=typeof e!="string"?e:e.length&&document.querySelector(e)?document.querySelector(e):document.createElement("canvas"),this.dom.style.aspectRatio=`${i} / ${s}`,this.w=i,this.h=s,this._ctx=this.dom.getContext("2d"),this._ctx.imageSmoothingEnabled=!1,this._eng=r,r.cameras.push(this),r.inp.bind(this)}},re=class{x=0;_x=0;_gx=0;get dx(){return this.x-this._x}set dx(e){this._x=this.x-e}y=0;_y=0;_gy=0;get dy(){return this.y-this._y}set dy(e){this._y=this.y-e}rx=0;_rx=0;_grx=0;get drx(){return this.rx-this._rx}set drx(e){this._rx=this.rx-e}ry=0;_ry=0;_gry=0;get dry(){return this.ry-this._ry}set dry(e){this._ry=this.ry-e}b=0;_b=0;get db(){return this.b^this._b}set db(e){this._b=this.b^e}cb(e,r=null){return(this.db&e)!=0&&(r==null?(this.b&e)!=0:(this.b&e)==r)}sx=0;_sx=0;get dsx(){return this.sx-this._sx}set dsx(e){this._sx=this.sx-e}sy=0;_sy=0;get dsy(){return this.sy-this._sy}set dsy(e){this._sy=this.sy-e}get gx(){return this.x-this._gx}get gy(){return this.y-this._gy}get grx(){return this.rx-this._grx}get gry(){return this.ry-this._gry}get g(){return Math.hypot(this.gx,this.gy)}get gr(){return Math.hypot(this.grx,this.gry)}click(e=1){return this.g<e&&this.cb(1,0)}over(e,r=[0,0],i){let s=i??(this._cam.def.c!=null?this._cam.def.c:1),t=(this.x-this._cam.w/2*s+this._cam.x*s*this._cam.sx)*Math.pow(this._cam.sx,-s)-r[0],p=(this.y-this._cam.h/2*s+this._cam.y*s*this._cam.sy)*Math.pow(this._cam.sy,-s)-r[1],n=!1;for(let o=0,h=e.length-1;o<e.length;h=o++){let m=e[o].length==2&&e[h].length==2;if(o==0&&e[h].length==0&&h--,o!=0&&o+1<e.length&&e[o].length==0&&e[o-1].length==2&&e[o+1].length==2){let u=e[o-1][0],c=e[o-1][1],b=u+e[o+1][0],v=c+e[o+1][1];c>p!=v>p&&u>t!=b>t&&(n=!n),o++}else if(m){let u=e[o][0],c=e[o][1],b=e[h][0],v=e[h][1];c>p!=v>p&&t<(b-u)*(p-c)/(v-c)+u&&(n=!n)}}return n}in(...e){for(let r of e)if(this.x>r[0]&&this.x<r[0]+r[2]&&this.y>r[1]&&this.y<r[1]+r[3])return!0;return!1}rin(...e){for(let r of e)if(this.rx>r[0]&&this.rx<r[0]+r[2]&&this.ry>r[1]&&this.ry<r[1]+r[3])return!0;return!1}key={};dkey={};handle(e){if(e instanceof WheelEvent)this.sx+=e.deltaX,this.sy+=e.deltaY;else if(e instanceof MouseEvent){let r=this._cam.dom.getBoundingClientRect(),i=this._cam.w/this._cam.h,s=i>r.width/r.height?[r.width,r.width/i]:[r.height*i,r.height];this.x=(e.clientX-r.left-(r.width-s[0])/2)/s[0]*this._cam.w,this.y=(e.clientY-r.top-(r.height-s[1])/2)/s[1]*this._cam.h,this.rx=(this.x-this._cam.w/2+this._cam.x)/this._cam.sx,this.ry=(this.y-this._cam.h/2+this._cam.y)/this._cam.sy,this.b=e.buttons,this.cb(1)&&(this._gx=this.x,this._gy=this.y,this._grx=this.rx,this._gry=this.ry),e.preventDefault()}else e instanceof KeyboardEvent&&(e.type=="keydown"?this.key[e.key.toLowerCase()]=this.dkey[e.key.toLowerCase()]=Number(e.ctrlKey)+(Number(e.shiftKey)<<1)+(Number(e.altKey)<<2):(delete this.key[e.key.toLowerCase()],this.dkey[e.key.toLowerCase()]=-1))}reset(){this.dx=0,this.dy=0,this.db=0,this.dsx=0,this.dsy=0,this.drx=0,this.dry=0,this.dkey={}}constructor(e){this._eng=e}_eng;bind(e){this._cam=e,addEventListener("wheel",r=>this.handle(r)),addEventListener("mousemove",r=>this.handle(r)),addEventListener("mouseover",r=>this.handle(r)),addEventListener("mousedown",r=>this.handle(r)),addEventListener("mouseup",r=>this.handle(r)),addEventListener("mouseenter",r=>this.handle(r)),addEventListener("mouseout",r=>this.handle(r)),addEventListener("keydown",r=>this.handle(r)),addEventListener("keyup",r=>this.handle(r))}_cam},w=class{static res=[];static depend=[];render(e,r,i){return[]}eng=null;scene=null;constructor(...e){}},B=class{entities=[];add(...e){for(let r of e)r.eng=this.eng,this.entities.push(r)}remove(...e){for(let r=0;r<this.entities.length;r++)e.includes(this.entities[r])&&(this.entities.slice(r,1),r--)}show(e){e?e.scene=this:this.eng.cameras.length&&(this.eng.cameras[0].scene=this)}eng;constructor(e,...r){this.eng=e,this.add(...r)}},H=class{imgs={};fonts={};audios={};base="";load(e,...r){let i=[];for(let s of r)i.push(...s.res),s.depend.length&&i.push(...this.load(null,...s.depend));return e!=null&&this.load_res(e,...i),i}load_res(e,...r){let i=[],s=!1,t=(n,o)=>{n==-1&&(this.load_err.push(this.base+r[o]),s=!0),i[o][0]=n,e(s?-1:i.map(h=>h[0]/h[1]).reduce((h,m)=>h+m)/i.length)},p=0;for(let n of r){if(n in this.imgs||n in this.fonts||n in this.audios){i.push([0,1]),t(1,p),p++;continue}let o=n.split(".").reverse()[0].toLowerCase();if(["png","jpg","jpeg"].includes(o)){i.push([0,1]);let h=new Image,m=p;h.onload=()=>t(1,m),h.onerror=()=>t(-1,m),h.src=this.base+n,this.imgs[n]=h}else if(["mp3","wav"].includes(o)){i.push([0,1]),this.audios[n]=new Audio;let h=p,m=this.audios[n];m.active=!1,m.oncanplaythrough=()=>t(1,h),m.onerror=()=>t(-1,h),m.src=this.base+n,m.volume=0,m.addEventListener("ended",()=>{m.currentTime=0,m.play()}),m.load()}else if(["ttf","mp3","wav"].includes(o)){i.push([0,5]);let h=p,m=new XMLHttpRequest;m.open("GET",this.base+n),m.responseType="blob",m.onreadystatechange=()=>{if(t(m.readyState,h),m.readyState==4&&m.status!=200)return t(-1,h);if(!(m.readyState!=4||m.status!=200)){if(o=="ttf"){let u=this.fonts[n]=`font_${Object.keys(this.fonts).length}`,c=document.createElement("h1");c.style.font=`20px ${u}`,c.innerHTML=u,c.style.position="fixed",c.style.left="0",c.style.top="100%";let b=document.createElement("style");b.innerHTML+=`@font-face {font-family:"${u}";src:url("${URL.createObjectURL(m.response)}") format("truetype");}`,document.head.appendChild(b),document.body.appendChild(c);let v=$=>{document.fonts.check(`20px ${u}`)?t(5,h):$>1e3?t(-1,h):setTimeout(v,10,$+1)};v(0)}if(["mp3","wav"].includes(o)){this.audios[n]=new Audio;let u=this.audios[n];u.active=!1,u.src=URL.createObjectURL(m.response),u.volume=0,u.addEventListener("ended",()=>{u.currentTime=0,u.play()}),t(5,h)}else t(5,h)}},m.send()}else i.push([0,1]),this.error_add(new Error(`Unknown file type "${o}"`)),t(-1,p);p++}s||e(0)}errors=[];load_err=[];error_add(e){for(let r of this.errors)if(r.message==e.message)return;this.errors.push(e),console.log(e)}cameras=[];inp;debug={m:[1,0,0,1,0,0],_m:[1,0,0,1,0,0],mp:e=>{if(this.inp.key.a!=null&&(this.debug.m[0]-=e*(this.inp.key.a==0?1:this.inp.key.a&2?.25:0)),this.inp.key.d!=null&&(this.debug.m[0]+=e*(this.inp.key.d==0?1:this.inp.key.d&2?.25:0)),this.inp.key.q!=null&&(this.debug.m[1]-=e*(this.inp.key.q==0?1:this.inp.key.q&2?.25:0)),this.inp.key.e!=null&&(this.debug.m[1]+=e*(this.inp.key.e==0?1:this.inp.key.e&2?.25:0)),this.inp.key.x!=null&&(this.debug.m[2]-=e*(this.inp.key.x==0?1:this.inp.key.x&2?.25:0)),this.inp.key.z!=null&&(this.debug.m[2]+=e*(this.inp.key.z==0?1:this.inp.key.z&2?.25:0)),this.inp.key.s!=null&&(this.debug.m[3]-=e*(this.inp.key.s==0?1:this.inp.key.s&2?.25:0)),this.inp.key.w!=null&&(this.debug.m[3]+=e*(this.inp.key.w==0?1:this.inp.key.w&2?.25:0)),this.inp.key.c!=null&&(this.debug.m[4]-=e*(this.inp.key.c==0?4:this.inp.key.c&2?.25:0)),this.inp.key.v!=null&&(this.debug.m[4]+=e*(this.inp.key.v==0?4:this.inp.key.v&2?.25:0)),this.inp.key.r!=null&&(this.debug.m[5]-=e*(this.inp.key.r==0?4:this.inp.key.r&2?.25:0)),this.inp.key.f!=null&&(this.debug.m[5]+=e*(this.inp.key.f==0?4:this.inp.key.f&2?.25:0)),this.inp.key[1]!=null||this.inp.key[2]!=null){let r=Math.PI/16*e*(this.inp.key[1]!=null?1:-1),i=Math.cos(r),s=Math.sin(r),t=[...this.debug.m];this.debug.m=[t[0]*i+t[2]*s,t[1]*i+t[3]*s,t[2]*i-t[0]*s,t[3]*i-t[1]*s,t[4],t[5]]}if(!Object.keys(this.inp.key).length){for(let r=0;r<6;r++)if(this.debug.m[r]!=this.debug._m[r]){console.log("DEBUG MATRIX:",this.debug.m.toString()),this.debug._m=[...this.debug.m];break}}},v:1,vp:e=>{this.inp.key.a!=null&&(this.debug.v-=e*(this.inp.key.a==0?1:this.inp.key.a&2?.25:0)),this.inp.key.d!=null&&(this.debug.v+=e*(this.inp.key.d==0?1:this.inp.key.d&2?.25:0)),console.log(this.debug.v)}};_wait=0;_times=[];_start;get fps(){return this._times.length}set fps(e){this._wait=e?2e3/e:0}scene=null;start_loop(e=!0){let r=performance.now(),i=this._times.length?r-this._times[this._times.length-1]:0;this._times=this._times.filter(t=>r-t<=1e3),this._times.push(r),e&&(this._start=r);for(let t in this.audios)this.audios[t].active=!1;let s=0;for(let t of this.cameras){t.cursor="default",t.clear(),t.fit&&t.fitfull(),t.tolisten=[];let p=[];if(t.scene!=null)for(let h of t.scene.entities){let m=z(h.render(i/1e3,r-this._start,t));for(let u of m)p.push(u)}let n=0,o=0;for(let h=p.length-1;h>=0;h--){let m=p[h];!m.hover&&!m.press&&!m.click||(m.p==null&&(m.p=t.rect(m)),this.inp.over(m.p,[m.x??0,m.y??0],m.c??1)&&(o==0&&m.hover&&m.hover(m),n==0&&m.click&&this.inp.click()&&(m.click(m),n++),m.press&&this.inp.b&1&&this.inp.g<1&&m.press(m)))}t.render({},...p),t.dom.style.cursor=t.cursor,this.loop(i/1e3,r-this._start,t),s++}for(let t in this.audios){let p=this.audios[t];p.active&&p.paused?p.play():!p.active&&!p.paused&&(p.currentTime=0,p.pause())}this.inp.reset(),setTimeout(()=>this.start_loop(!1),this._wait-i>0?this._wait-i:0)}loop=()=>{};constructor(){this.inp=new re(this),this.start_loop()}};function z(a){if(!a.length)return a;let[e,...r]=a,i=[];for(let s of r)i.push({...e,...s});return i}function se(a,e,r=0,i=0,s=1,t=1,p="p"){let n=(o,h,m)=>{let u=`${r+h}_${i+m}`,c=0;e[u]&&e[u].data&&e[u].data[p]&&(c=e[u].data[p]);let b=structuredClone(a[c|o]);b.f||(b.f="tile/test.png"),b.data={...e[u]?.data||{},...a[c|o]?.data||{}},b.data[p]=c|o,e[u]=b};for(let o=0;o<s;o++)for(let h=0;h<t;h++)n(15,o,h);for(let o=0;o<s;o++)n(3,o,-1);for(let o=0;o<s;o++)n(12,o,t);for(let o=0;o<t;o++)n(5,-1,o);for(let o=0;o<t;o++)n(10,s,o);n(1,-1,-1),n(2,s,-1),n(4,-1,t),n(8,s,t)}var O=class extends w{per=0;start=()=>{};render(e,r,i){return this.eng==null?[]:[{c:0},...this.per!=1?[{p:[[-100,-10],[],[200,20],[]],b:this.per<0?"red":"white",bz:2,x:i.w/2,y:i.h/2},{a:this.per<0?0:1,p:[[-96,-6],[],[192*this.per,12],[]],f:"white",x:i.w/2,y:i.h/2},{t:this.per<0?"Error loading assets":"Loading...",f:this.per<0?"red":"white",x:i.w/2,y:i.h/2-30},{a:this.per<0?.75:0,t:`failed: ${this.eng.load_err[this.eng.load_err.length-1]}`,tz:15,f:"red",x:i.w/2,y:i.h/2+30}]:[{x:i.w/2,y:i.h/2,t:"Click to start game",f:"white"},{p:[[0,0],[],[i.w,i.h],[]],click:s=>this.start()}]]}};var x=class extends w{static key="";item="";focused=!1;own=1;price=0;on_focused=()=>{};popup=[];x;y;name="Building";base(e,r,i,s=1){this._c+=((this.focused?0:1)-this._c)*e*10;let t=this._c;return{c:t,x:this.x*t+.25*i.w*(1-t),y:this.y*t+.6*i.h*(1-t),s:s*t+1*(1-t),click:p=>{this.focused=!0,this.on_focused(this)}}}_c=1;render_pin(e,r,i,s=1){return this.popup.length==0?[]:[{x:this.x,y:this.y-100},{f:"ui/pin.png",s:.25,oy:.4,click:t=>{this.focused=!0,this.on_focused(this)}},...this.popup]}menu(e,r,i,s){return[]}constructor(e,r,i,s){super(),this.eng=e.eng,this.x=r*72+i*64,this.y=i*36-r*19}};var ne=class{money=0;own=[];item=[];saving=0;loan=0;logs=[[],[]];last=0;day=0;update(){performance.now()-this.last<1e3||(this.logs[0].push(this.saving),this.logs[1].push(this.loan),this.last=performance.now(),this.logs[0]=this.logs[0].slice(-100),this.logs[1]=this.logs[1].slice(-100))}loaned(e){if(e<0&&this.money<-e)return M([{t:"Insufficent funds ",f:"#F44336",tz:15}]);if(this.loan>1e5)return M([{t:"Reached Max loaned",f:"#F44336",tz:15}]);this.loan+e>1e5&&(M([{t:"Reached Max loaned",f:"black",tz:15}]),e=1e5-this.loan),this.money+=e,this.loan+=e}saved(e){if(e<0&&this.saving<-e)return M([{t:"Insufficent savings ",f:"#F44336",tz:15}]);if(this.money<e)return M([{t:"Insufficent funds",f:"#F44336",tz:15}]);this.money-=e,this.saving+=e}purchase(e){if(this.money<e.price)return M([{t:"Insufficent funds",f:"#F44336",tz:15}]);this.money-=e.price,e.own=2,this.own.push(e)}},f=new ne;var d=class extends w{name="";quantity=0;price=0;base(e,r,i,s=1){return{c:0}}menu(e,r,i){return[]}render(e,r,i){return[]}};var P=class extends d{static res=["item/beef.png"];name="Beef";price=400;render(e,r,i){return[this.base(e,r,i),{f:"item/beef.png",s:.125,m:[1,0,0,1,0,-90]}]}};var j=class extends d{static res=["item/carrot.png"];name="Carrot";price=130;render(e,r,i){return[this.base(e,r,i),{f:"item/carrot.png",s:.125,m:[1,0,0,1,0,-70]}]}};var U=class extends d{static res=["item/chicken.png"];name="Chicken";price=185;render(e,r,i){return[this.base(e,r,i),{f:"item/chicken.png",s:.125,m:[1,0,0,1,0,-90]}]}};var k=class extends d{static res=["item/fertilizer.png"];name="Fertilizer";price=32;render(e,r,i){return[this.base(e,r,i),{f:"item/fertilizer.png",s:.125,m:[1,0,0,1,0,-70]}]}};var T=class extends d{static res=["item/fish.png"];name="Fish";price=175;render(e,r,i){return[this.base(e,r,i),{f:"item/fish.png",s:.125,m:[1,0,0,1,0,-70]}]}};var C=class extends d{static res=["item/garlic.png"];name="Garlic";price=250;render(e,r,i){return[this.base(e,r,i),{f:"item/garlic.png",s:.125,m:[1,0,0,1,0,-90]}]}};var X=class extends d{static res=["item/kadyos.png"];name="Kadyos";price=200;render(e,r,i){return[this.base(e,r,i),{f:"item/kadyos.png",s:.125,m:[1,0,0,1,0,-90]}]}};var D=class extends d{static res=["item/langka.png"];name="Langka";price=100;render(e,r,i){return[this.base(e,r,i),{f:"item/langka.png",s:.125,m:[1,0,0,1,0,-90]}]}};var K=class extends d{static res=["item/pork.png"];name="Pork";price=350;render(e,r,i){return[this.base(e,r,i),{f:"item/pork.png",s:.125,m:[1,0,0,1,0,-90]}]}};var Y=class extends d{static res=["item/radish.png"];name="Radish";price=50;render(e,r,i){return[this.base(e,r,i),{f:"item/radish.png",s:.125,m:[1,0,0,1,0,-90]}]}};var N=class extends d{static res=["item/soup.png"];name="Soup";price=35;render(e,r,i){return[this.base(e,r,i),{f:"item/soup.png",s:.15,m:[1,0,0,1,0,-60]}]}};var W=class extends d{static res=["item/tomato.png"];name="Tomato";price=80;render(e,r,i){return[this.base(e,r,i),{f:"item/tomato.png",s:.125,m:[1,0,0,1,0,-90]}]}};var S=class extends d{static res=["item/tuna.png"];name="Tuna";price=270;render(e,r,i){return[this.base(e,r,i),{f:"item/tuna.png",s:.15,m:[1,0,0,1,0,-60]}]}};var F=class extends d{static res=["item/worm.png"];name="Worm";price=650;render(e,r,i){return[this.base(e,r,i),{f:"item/worm.png",s:.125,m:[1,0,0,1,0,-90]}]}};var I=[T,P,j,U,k,C,X,D,K,Y,N,W,S,F],he=[{type:"farm",in:[k],out:[j],amount:[1,20],dur:2},{type:"farm",in:[k],out:[C],amount:[1,10],dur:1},{type:"farm",in:[k],out:[C],amount:[1,10],dur:1},{type:"farm",in:[k],out:[C],amount:[1,10],dur:1},{type:"farm",in:[k],out:[C],amount:[1,10],dur:1},{type:"farm",in:[k],out:[C],amount:[1,10],dur:1},{type:"farm",in:[k],out:[C],amount:[1,10],dur:1},{type:"farm",in:[k],out:[C],amount:[1,10],dur:1},{type:"fish",in:[F],out:[T],amount:[1,50],dur:1},{type:"factory",in:[T],out:[S],amount:[1,2],dur:0}];function g(a,e,r=1,i=1,s=0){let t=[];"t"in a&&(t.push({t:a.t,tz:a.tz??20,b:"black",bz:a.bz??4,x:a.x??0,y:(a.y??0)+3,f:a.f??"white"}),delete a.t,delete a.tz,delete a.f,delete a.bz),"f"in a&&(t.push({f:a.f,x:(a.x??0)+(a.data?.x??0),y:(a.y??0)+(a.data?.y??0),s:.25,o:a.o??"",r:a.r??0,a:s==3?.5:1}),delete a.f,delete a.r);let p=a.click;return"click"in a&&delete a.click,a.click=n=>{n.data&&n.data.disabled||(n.data?.button&&e.play("sfx/button.mp3",.25),p&&p(n))},[{f:s==3?"ui/button_disabled.png":s==2?"ui/button_down.png":"ui/button_up.png",s:.25,crop:[60,59,60,59,57,56,r,i],press:n=>{n.data&&n.data.button&&(n.f="ui/button_down.png")},...a,data:{...a.data??{},button:s==0,disabled:s==3}},...t]}var R=class a extends w{static res=["coins.png","ui/title.png","ui/resume.png","ui/options.png","ui/exit.png","ui/close.png","ui/menu.png","ui/bag.png","ui/next.png","font/emulogic.ttf","music/bgm1_prototype.wav","sfx/button.mp3","sfx/whoosh.mp3","ui/button_up.png","ui/button_down.png","ui/button_disabled.png","plan.png"];static depend=I;pop=[];pop_c=0;pop_t=0;help=0;help_c=0;closed=()=>{};popup(e){this.pop=e,this.pop_t=0}focused=()=>{};menu=0;m=0;focus=null;title="Inventory";sprites=[];render(e,r,i){if(this.eng==null)return[];if(this.pop_c+=((this.pop.length?1:0)-this.pop_c)*e*10,this.pop.length&&this.pop_t==0){this.pop_t=performance.now();for(let n of this.pop)n.c=n.c??0}this.pop.length&&performance.now()-this.pop_t>3e3&&(this.pop=[]),this.help_c+=(this.help-this.help_c)*e*10,this.eng.inp.dkey.q==0&&(this.help=1-this.help),this.m+=(this.menu-this.m)*e*10,this.menu!=2&&this.focus!=null&&Math.abs(this.m-2)>.99&&(this.focus=null);let s=(...n)=>n.map(o=>Math.max(0,1-Math.abs(this.m-o))).reduce((o,h)=>o+h,0),t=Math.floor(r/200)%4,p=(n,o=1,h=1,m=0)=>g(n,i,o,h,m);return[{c:0,hover:n=>{n.click&&(n.cur="pointer")},tf:"font/emulogic.ttf"},{f:"music/bgm1_prototype.wav"},{f:"black",p:[[0,0],[],[i.w,i.h]],a:.5*s(0,2),click:this.menu==1?void 0:()=>{}},...this.focus==null?[]:z(this.focus.render(e,r,i)),{x:i.w*.5,y:i.h*.25*(2*s(0)-1),f:a.res[1],s:.35},{f:"coins.png",x:(i.w*.72+25)*s(0)-50*s(0)+25,y:(i.h*.2+25)*s(0)-50*s(0)+25,crop:[Math.abs(2-t)*22,0,22,23],sx:t==1?-1.5:1.5,sy:1.5},{t:String(f.money),tz:20,x:44,y:28-38*s(0),o:"w",f:"gold",b:"black",bz:4},{t:String(f.day),tz:20,x:i.w-130,y:28-38*s(0,2),o:"e",f:"white"},{t:String(this.eng.fps),o:"nw",tz:8},...p({x:i.w/2,y:i.h-200*s(0)+50,t:"resume",f:"#4CAF50",click:n=>this.menu=1},10,2),...p({x:i.w/2,y:i.h-200*s(0)+105,t:"options",f:"#2196F3"},10,2),...p({x:i.w/2,y:i.h-200*s(0)+160,t:"exit",f:"#F44336"},10,2),...p({x:i.w+30-40*s(1),y:10,o:"ne",f:"ui/menu.png",click:n=>this.menu=0,data:{x:-3,y:9}}),...p({x:i.w+30-80*s(1),y:10,o:"ne",f:"ui/bag.png",click:n=>{this.title="Inventory",this.menu=2},data:{x:-7,y:7}}),...p({x:i.w+30-120*s(1),y:10,o:"ne",f:"ui/next.png",click:n=>{},data:{x:-10,y:9}}),...p({x:i.w+70-80*s(2),y:10,o:"ne",f:"ui/close.png",click:n=>{this.closed(),this.focus&&(this.focus.focused=!1),this.menu=1},data:{x:-4,y:6}}),...this.focus==null||this.title.toLowerCase()=="inventory"?[...p({x:i.w/2,y:i.h+150-(i.h/2+135)*s(2)},40,20,1),...Array(32).fill(0).map((n,o)=>{let h=o%8,m=Math.floor(o/8);return{c:0,f:"ui/button_down.png",s:.25,crop:[60,59,60,59,57,56,3,3],x:75+70*h,y:90+70*m+(i.h-50)*(1-s(2))}}),...f.own.map((n,o)=>{let h=o%8,m=Math.floor(o/8);return[...z(n.render(e,r,i)).map(u=>(u.c=0,u.x=75+70*h,u.y=100+70*m+(i.h-50)*(1-s(2)),u.s=.25,u.click=void 0,u)),{c:0,x:75+70*h,y:90+70*m+(i.h-50)*(1-s(2)),p:[[-28,-28],[],[58,57],[]],click:u=>{i.x=n.x,i.y=n.y,this.menu=1}}]}).flat(),...f.item.map((n,o)=>{let h=(o+f.own.length)%8,m=Math.floor((o+f.own.length)/8);return z(n.render(e,r,i)).map(u=>(u.x=75+70*h,u.y=100+70*m+(i.h-50)*(1-s(2)),u))}).flat()]:[...p({x:i.w+150-(i.w/2+5)*s(2),y:i.h/2+15},20,19,1),...p({x:i.w/4,y:i.h+25-(i.h/8+25)*s(2),...[{t:"Cant Own",f:"#F44336"},{t:"Purchase",f:"#4CAF50",click:n=>{this.focus instanceof x&&f.purchase(this.focus)}},{t:"Sell",f:"#2196F3"}][this.focus.own]??{t:"Unknown",f:"#F44336"}},15,2),...this.focus.price&&this.focus.own==1?[{t:`\u20B1${this.focus.price}`,x:i.w/4,y:i.h+25-(i.h/4+15)*s(2),f:"white",a:.75}]:[],...this.focus.menu(e,r,i,s(2)).map(n=>(n.c=n.c??0,n.x=(n.x??0)+i.w+150-(i.w/2+5)*s(2),n.y=(n.y??0)+i.h/2+15,n))],...this.title.toLowerCase()=="inventory"?[{t:this.title,tz:20,b:"black",bz:4,x:i.w/2,y:28*s(2)-10*(1-s(2)),f:"skyblue"}]:[{t:this.title,tz:15,b:"black",bz:4,x:i.w/4,y:70*s(2)-10*(1-s(2)),f:"skyblue"}],...p({x:i.w/2,y:50*this.pop_c-30,click:n=>this.pop=[]},22,3),...this.pop.map(n=>(n.x=i.w/2,n.y=50*this.pop_c-25,n)),{f:"plan.png",o:"nw",s:.5,y:i.h*(1-this.help_c)}]}};var G=class extends x{static res=["building/bank.png"];static key="bank";item="building/bank.png";own=0;name="DBO Bank";act_loan_pay=!1;act_save_out=!1;render(e,r,i){return[this.base(e,r,i),{f:"building/bank.png",p:[[-62,-100],[],[133,130],[]],m:[1,0,0,1,4,-32]}]}menu(e,r,i){let s=f.logs[0],t=f.logs[1],p=Math.max(100,Math.max(...s,...t));return[...g({x:0,y:-98},i,19,4,2),{p:s.length<2?[[0,55],[270,55]]:s.map((n,o)=>[270*o/(s.length-1),55*(1-n/p)]),b:"green",x:-135,y:-125,bz:2,a:.5},{p:t.length<2?[[0,55],[270,55]]:t.map((n,o)=>[270*o/(t.length-1),55*(1-n/p)]),b:"red",x:-135,y:-125,bz:2,a:.5},{t:"Savings (5% rate)",o:"w",x:-140,y:-30,f:"black",tz:10,a:.75},{t:String(f.saving),o:"w",x:-140,y:-10,f:"black",tz:15},...g({x:-100,y:15,t:"1,000",tz:15,f:"black",bz:0,click:n=>f.saved(1e3*(this.act_save_out?-1:1))},i,5,1),...g({x:0,y:15,t:"10,000",tz:15,f:"black",bz:0,click:n=>f.saved(1e4*(this.act_save_out?-1:1))},i,6,1),...g({x:100,y:15,t:"100k",tz:15,f:"black",bz:0,click:n=>f.saved(1e5*(this.act_save_out?-1:1))},i,5,1),...g({x:90,y:-20,t:this.act_save_out?"deposit":"withdraw",tz:10,f:"black",bz:0,click:n=>this.act_save_out=!this.act_save_out},i,6,1),{t:"Loans (8% rate)",o:"w",x:-140,y:70,f:"black",tz:10,a:.75},{t:String(f.loan),o:"w",x:-140,y:90,f:"black",tz:15},...g({x:-100,y:115,t:"1,000",tz:15,f:"black",bz:0,click:n=>f.loaned(1e3*(this.act_loan_pay?-1:1))},i,5,1),...g({x:0,y:115,t:"10,000",tz:15,f:"black",bz:0,click:n=>f.loaned(1e4*(this.act_loan_pay?-1:1))},i,6,1),...g({x:100,y:115,t:"100k",tz:15,f:"black",bz:0,click:n=>f.loaned(1e5*(this.act_loan_pay?-1:1))},i,5,1),...g({x:90,y:80,t:this.act_loan_pay?"take loan":"pay back",tz:10,f:"black",bz:0,click:n=>this.act_loan_pay=!this.act_loan_pay},i,6,1)]}};var J=class extends x{static res=["building/blank_mask.png"];static key="blank";item="building/blank_mask.png";own=0;name="Private building";color=["white","white","white"];render(e,r,i){let s=this.base(e,r,i);return[{x:s.x??0,y:s.y??0,c:s.c??1},{p:[[-45,-33],[0,-7],[50,-20],[50,11],[0,24],[-38,2],[-45,0],[]],f:this.color[0]},{p:[[-45,-65],[0,-39],[50,-52],[50,-20],[0,-7],[-45,-33],[]],f:this.color[1]},{p:[[-49,-69.5],[8,-85],[54,-58],[54,-54],[53,-53],[53,-50],[0,-36],[-47,-64],[-47,-65],[-49,-67],[]],f:this.color[2]},{f:"building/blank_mask.png",p:[[-48,-85],[],[102,110],[]],m:[1,0,0,1,0,-30],...s}]}constructor(e,r,i,s){super(e,r,i,s),s.color?.length==3&&(this.color=s.color)}};var Q=class extends x{static res=["building/callereal.png","ui/triangle.png"];static key="callereal";static depend=I;item="building/callereal.png";own=0;name="Calle Real";items=[];page=0;constructor(e,r,i,s){super(e,r,i,s);for(let t of I)this.items.push(new t)}render(e,r,i){return[this.base(e,r,i),{f:"building/callereal.png",p:[[-85,-140],[],[185,160],[]],m:[1,0,0,1,0,-60]}]}menu(e,r,i,s){return[...g({x:0,y:-98},i,19,4,2),...this.items.slice(4*this.page,4*(this.page+1)).map((t,p)=>[...g({x:0,y:-36+48*p},i,19,2),...z(t.render(e,r,i)).map(n=>(n.x=-120,n.y=-26+48*p,n)),{t:t.name,x:-100,y:-46+48*p,o:"nw",tz:15}]).flat(),...g({x:-170+40*(1-s),y:50,f:"ui/triangle.png",r:-Math.PI/2,click:t=>{this.page--}},i,1,1,this.page>0?0:3),...g({x:-170+40*(1-s),y:80,f:"ui/triangle.png",r:Math.PI/2,click:t=>{this.page++}},i,1,1,this.page*4+4<this.items.length?0:3)]}};var V=class extends x{static res=["building/factory.png"];static key="factory";item="building/factory.png";name="Factory";render(e,r,i){return[this.base(e,r,i),{f:"building/factory.png",p:[[-75,-125],[],[165,145],[]],m:[1,0,0,1,0,-50]}]}};var Z=class extends x{static res=["building/farm.png","ui/arrow.png"];static key="farm";item="building/farm.png";name="Farm";price=5e4;render(e,r,i){return[this.base(e,r,i),{f:"building/farm.png",p:[[-64,-49],[],[120,97],[]],m:[1,0,0,1,0,-10]}]}page=0;processes=he.filter(e=>e.type=="farm").map(e=>({in:e.in.map(r=>new r),out:e.out.map(r=>new r)}));menu(e,r,i,s){return[...this.processes.slice(this.page*5,5*(this.page+1)).map((t,p)=>[...g({x:0,y:-82+48*p},i,16,2),...g({x:-130,y:-75+48*p},i,1,1)]).flat()]}};var ee=class extends x{static res=["building/fishing.png"];static key="fishing";item="building/fishing.png";name="Fishing Area";price=5e4;render(e,r,i){return[this.base(e,r,i,.75),{f:"building/fishing.png",m:[1,0,0,1,5,-35],p:[[-70,-80],[],[145,110],[]]}]}};var ue=[G,J,Q,V,Z,ee];var A=class a extends w{static res=["tile/grass_0.png","tile/sand_0.png","tile/sand1.png","tile/water_0.png","tile/water_1.png","tile/ws_x_0.png","tile/ws_y_0.png","tile/ws_xy_0.png","tile/ws__0.png","tile/ws_x_1.png","tile/ws_y_1.png","tile/ws_xy_1.png","tile/ws__1.png","tile/sg_x_0.png","tile/sg_y_0.png","tile/sg_xy_0.png","tile/sg__0.png","tile/test.png","road/dirt.png","road/dirt_empty.png","road/cement.png","road/cement_empty.png","prop/tree.png","prop/bush.png","tile/water_bg_0.png","tile/water_bg_1.png","ui/pin.png"];static depend=ue;ly=[{},{}];focused=()=>{};generate(e=[]){this.ly=[{},{}];let[r,i]=this.ly;for(let s of e){let t=!0,p=`${s.x}_${s.y}`;if(s.w==null&&(s.w=1),s.h==null&&(s.h=1),s.type=="sand")se([{},{data:{pre:"ws_xy"},m:[.312,.463,-2.45,-.23,-1,1]},{data:{pre:"ws_xy"},m:[-1,0,0,-1,-1,1]},{data:{pre:"ws_y"},m:[-1,0,0,-1,-1,1]},{data:{pre:"ws_xy"}},{data:{pre:"ws_x"}},{},{data:{pre:"ws_"},m:[-.2404,-.45704,2.5288,.2536,0,0]},{data:{pre:"ws_xy"},m:[-.355,.37,2.31,.38,-1,1]},{},{data:{pre:"ws_x"},m:[-1,0,0,-1,-1,1]},{data:{pre:"ws_"},m:[1,0,0,1,-2,0]},{data:{pre:"ws_y"}},{data:{pre:"ws_"},m:[.95175,.235,.275,-.951,0,.6285]},{data:{pre:"ws_"},m:[.26139,.4746,-2.4687,-.27096,4.952,2.076]},{data:{pre:"sand"}}],r,s.x,s.y,s.w,s.h);else if(s.type=="grass")se([{},{data:{top:"sg_xy"},m:[.312,.463,-2.45,-.23,-1,1]},{data:{top:"sg_xy"},m:[-1,0,0,-1,-1,1]},{data:{top:"sg_y"},m:[-1,0,0,-1,-1,1]},{data:{top:"sg_xy"}},{data:{top:"sg_x"}},{},{data:{top:"sg_"},m:[-.2404,-.45704,2.5288,.2536,0,0]},{data:{top:"sg_xy"},m:[-.355,.37,2.31,.38,-1,1]},{},{data:{top:"sg_x"},m:[-1,0,0,-1,-1,1]},{data:{top:"sg_"},m:[1,0,0,1,-2,0]},{data:{top:"sg_y"}},{data:{top:"sg_"},m:[.95175,.235,.275,-.951,0,.6285]},{data:{top:"sg_"},m:[.26139,.4746,-2.4687,-.27096,4.952,2.076]},{data:{top:"grass"}}],r,s.x,s.y,s.w,s.h,"pt");else if(s.type=="dirt")for(let n=0;n<s.w;n++){let o=`${s.v?s.x:s.x+n}_${s.v?s.y+n:s.y}`;o in i?i[o]={f:"road/dirt_empty.png",m:[1.33725,-.071745,-.24675,1.2205,0,0]}:o in r&&(i[o]={f:"road/dirt.png",m:s.v?[1.33725,-.071745,-.24675,1.2205,0,0]:[-1.27025,-.39275,0,1.2135,0,0]})}else if(s.type=="cement")for(let n=0;n<s.w;n++){let o=`${s.v?s.x:s.x+n}_${s.v?s.y+n:s.y}`;o in i?i[o]={f:"road/cement_empty.png",m:[1.33725,-.071745,-.24675,1.2205,0,0]}:o in r&&(i[o]={f:"road/cement.png",m:s.v?[1.33725,-.071745,-.24675,1.2205,0,0]:[-1.27025,-.39275,0,1.2135,0,0]})}else s.type=="tree"?i[p]={f:"prop/tree.png",m:[1,0,0,1,0,-25]}:s.type=="bush"?i[p]={f:"prop/bush.png",s:.08}:s.type=="test"?i[p]={f:"tile/test.png",a:.5}:t=!1;if(!t){for(let n of a.depend)if(s.type==n.key){let o=new n(this,s.x,s.y,s);o.on_focused=h=>this.focused(h),i[p]={data:{build:o}},t=!0,f.own.push(o)}}t||this.eng?.error_add(new Error(`Unknown type "${s.type}`))}for(let s in this.ly)for(let t in this.ly[s]){let p=t.split("_").map(o=>Number(o)),n=this.ly[s][t];Object.assign(n,{x:p[0]*72+p[1]*64,y:p[1]*36-p[0]*19}),s=="0"&&n.data?.pre&&(n.f=`tile/${n.data.top||n.data.pre}_0.png`)}}init=!0;render(e,r,i){i.tile({f:`tile/water_bg_${Math.floor(r/800)%2}.png`,s:.5});for(let s in this.ly[0]){let t=this.ly[0][s];t.data&&t.data.pre&&t.data.pre[0]=="w"&&!t.data.top&&(t.f=`tile/${t.data.pre}_${Math.floor(r/800)%2}.png`)}return[{hover:s=>{s.click&&(s.cur="pointer")}},...Object.values(this.ly[0]),...Object.values(this.ly[1]).map(s=>{if(s.data?.build){let t=s.data.build;return[...z(t.render(e,r,i)),...z(t.render_pin(e,r,i))]}return[s]}).reduce((s,t)=>[...s,...t],[])]}};var le=[{type:"sand",x:-10,y:-10,w:20,h:20},{type:"grass",x:-9,y:-9,w:18,h:18},{type:"fishing",x:7,y:9},{type:"dirt",x:3,y:-8,w:16,v:!0},{type:"cement",x:-8,y:1,w:16},{type:"bank",x:2,y:0},{type:"tree",x:1.3,y:.3},{type:"callereal",x:0,y:0},{type:"factory",x:-5,y:0},{type:"blank",x:5,y:0,color:["blue","brown","violet"]},{type:"blank",x:4,y:0,color:["red","yellow","green"]},{type:"bush",x:-2,y:0},{type:"farm",x:-2,y:0},{type:"tree",x:0,y:3}];var E=new H,te=new q("#game",E);E.base="/assets/";te.fit=!0;te.scale(4);for(let a of I)f.item.push(new a);var oe=new O,fe=new B(E,oe);E.load(a=>{oe.per=a,a==1&&de.show()},R,A);fe.show();oe.start=()=>{te.full(),de.show()};var ae=new A(E),L=new R,de=new B(E,ae,L);ae.generate(le);ae.focused=a=>{te.play("sfx/whoosh.mp3",.25,.4),L.title=a.name,L.menu=2,L.focus=a};function M(a){return L.popup(a)}L.menu=1;E.loop=(a,e,r)=>{let i=E.inp;if(f.update(),L.menu==1){if(i.dsy){let s=Math.max(.25,Math.min(8,r.sx*Math.pow(1.5,-i.dsy/100)));r.s=s}if(i.cb(1)&&i.dx&&i.dy,i.b&1){r.x-=i.dx/r.sx,r.y-=i.dy/r.sy;let s=1300*Math.min(1,r.sx),t=600*Math.min(1,r.sy);r.x=Math.min(s,Math.max(-s,r.x)),r.y=Math.min(t,Math.max(-t,r.y))}}};})();</script></body></html>